<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</title>
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <link rel="stylesheet" href="css/main.css">
    <style>
        .driver-header {
            background: linear-gradient(135deg, var(--driver), #15803d);
            color: white;
            padding: 25px 20px;
            border-radius: 0 0 25px 25px;
            box-shadow: 0 4px 20px rgba(22, 163, 74, 0.2);
            position: relative;
            z-index: 100;
        }
        
        .driver-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .driver-avatar {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--driver);
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .driver-details h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
        }
        
        .driver-details p {
            margin: 5px 0 0;
            opacity: 0.9;
        }
        
        .car-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 15px;
            border-radius: 12px;
            margin-top: 10px;
            backdrop-filter: blur(10px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--driver);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--gray);
        }
        
        .main-content {
            padding: 20px;
            padding-top: 0;
        }
        
        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 20px;
            background: #fef2f2;
            color: #ef4444;
            border: 2px solid #ef4444;
        }
        
        .status-indicator.online {
            background: #f0fdf4;
            color: var(--driver);
            border-color: var(--driver);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }
        
        .status-indicator.online .status-dot {
            background: var(--driver);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .toggle-btn {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .earnings-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .earning-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .earning-item:last-child {
            border-bottom: none;
        }
        
        .earning-label {
            font-size: 16px;
            color: var(--dark);
        }
        
        .earning-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--driver);
        }
        
        .earning-note {
            font-size: 12px;
            color: var(--gray);
            text-align: center;
            margin-top: 10px;
        }
        
        .recent-trips {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .trip-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .trip-item:last-child {
            border-bottom: none;
        }
        
        .trip-info h4 {
            margin: 0 0 5px;
            font-size: 16px;
        }
        
        .trip-info p {
            margin: 0;
            font-size: 14px;
            color: var(--gray);
        }
        
        .trip-amount {
            font-weight: 600;
            color: var(--primary);
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .logout-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            border: 2px solid var(--gray-light);
            color: var(--danger);
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
        <div class="driver-header">
            <div class="driver-info">
                <div class="driver-avatar" id="driver-avatar">?</div>
                <div class="driver-details">
                    <h2 id="driver-name">Ø§Ù„Ø³Ø§Ø¦Ù‚</h2>
                    <p id="driver-whatsapp"></p>
                    <div class="car-info" id="car-info"></div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="total-earnings">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="today-earnings">0</div>
                    <div class="stat-label">Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="completed-trips">0</div>
                    <div class="stat-label">Ø±Ø­Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="driver-balance">0</div>
                    <div class="stat-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
            <div class="status-card">
                <div class="status-indicator" id="status-indicator">
                    <div class="status-dot"></div>
                    <span id="status-text">ØºÙŠØ± Ù…ØªØµÙ„</span>
                </div>
                
                <p id="status-description">Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±ÙƒØ§Ø¨ØŒ Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„</p>
                
                <button class="btn btn-driver toggle-btn" id="toggle-status-btn" onclick="toggleDriverStatus()">
                    <span>âš¡ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„</span>
                </button>
            </div>
            
            <!-- Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
            <div class="earnings-card">
                <h3 style="margin: 0 0 20px 0; color: var(--dark); text-align: center;">ğŸ’° ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
                
                <div class="earning-item">
                    <span class="earning-label">Ø£Ø±Ø¨Ø§Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</span>
                    <span class="earning-value" id="weekly-earnings">0 SDG</span>
                </div>
                
                <div class="earning-item">
                    <span class="earning-label">Ø£Ø±Ø¨Ø§Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±:</span>
                    <span class="earning-value" id="monthly-earnings">0 SDG</span>
                </div>
                
                <div class="earning-item">
                    <span class="earning-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø­Ù„Ø©:</span>
                    <span class="earning-value" id="average-ride">0 SDG</span>
                </div>
                
                <div class="earning-note">
                    * Ø¨Ø¹Ø¯ Ø®ØµÙ… 6% Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø©
                </div>
            </div>
            
            <!-- Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
            <div class="recent-trips">
                <h3 style="margin: 0 0 20px 0; color: var(--dark); text-align: center;">ğŸš— Ø¢Ø®Ø± Ø§Ù„Ø±Ø­Ù„Ø§Øª</h3>
                <div id="recent-trips-list">
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸš—</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯</p>
                    </div>
                </div>
            </div>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showLocationSettings()">
                    <span>ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
                </button>
                
                <button class="btn btn-secondary" onclick="showWithdrawal()">
                    <span>ğŸ’° Ø³Ø­Ø¨ Ø§Ù„Ø±ØµÙŠØ¯</span>
                </button>
                
                <button class="btn" style="background: var(--gray-light); color: var(--gray);" onclick="showSupport()">
                    <span>ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</span>
                </button>
                
                <button class="btn" style="background: #fef2f2; color: #dc2626;" onclick="showEmergency()">
                    <span>ğŸš¨ Ø·ÙˆØ§Ø±Ø¦</span>
                </button>
            </div>
        </div>
        
        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
        <button class="logout-btn" onclick="logoutDriver()">
            <span>ğŸ‘‹ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ø§Ø¦Ù‚</span>
        </button>
    </div>
    
    <!-- ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="incoming-ride-overlay" class="overlay hidden">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
    
    <div id="active-trip-overlay" class="overlay hidden">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
    
    <div id="notification-area"></div>
    
    <!-- Ù…Ù„ÙØ§Øª JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const SB_URL = 'https://zsmlyiygjagmhnglrhoa.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzbWx5aXlnamFnbWhuZ2xyaG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NDc3NjMsImV4cCI6MjA4MTUyMzc2M30.QviVinAng-ILq0umvI5UZCFEvNpP3nI0kW_hSaXxNps';
        const supabase = supabase.createClient(SB_URL, SB_KEY);
        
        let currentDriver = null;
        let isOnline = false;
        let watchId = null;
        let currentRideId = null;
        let rideCountdownInterval = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            await checkDriverAuth();
            loadDriverData();
            updateEarnings();
            loadRecentTrips();
            
            // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©
            subscribeToRideRequests();
        });
        
        async function checkDriverAuth() {
            const savedDriver = localStorage.getItem('tarhal_driver');
            
            if (!savedDriver) {
                window.location.href = 'index.html';
                return;
            }
            
            currentDriver = JSON.parse(savedDriver);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
            try {
                const { data: driver, error } = await supabase
                    .from('drivers')
                    .select('is_active')
                    .eq('id', currentDriver.id)
                    .single();
                
                if (error || !driver.is_active) {
                    showNotification('Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù…ÙØ¹Ù„ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'error');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Driver auth check error:', error);
            }
        }
        
        function loadDriverData() {
            document.getElementById('driver-avatar').textContent = currentDriver.full_name.charAt(0);
            document.getElementById('driver-name').textContent = currentDriver.full_name;
            document.getElementById('driver-whatsapp').textContent = currentDriver.whatsapp_number;
            document.getElementById('driver-balance').textContent = currentDriver.balance.toLocaleString();
            
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            const carInfo = document.getElementById('car-info');
            carInfo.innerHTML = `
                ${getVehicleTypeName(currentDriver.car_type)} â€¢ ${currentDriver.car_model}
                <br><small>${currentDriver.car_plate} â€¢ ${currentDriver.car_color || ''}</small>
            `;
        }
        
        function getVehicleTypeName(type) {
            const names = {
                tuktuk: 'Ø±ÙƒØ´Ø©',
                economy: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©',
                comfort: 'Ù…ØªÙˆØ³Ø·Ø©',
                vip: 'VIP'
            };
            return names[type] || type;
        }
        
        async function updateEarnings() {
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…
                const { data: todayRides, error: todayError } = await supabase
                    .from('rides')
                    .select('driver_earnings')
                    .eq('driver_id', currentDriver.id)
                    .gte('completed_at', today.toISOString())
                    .eq('status', 'completed');
                
                if (!todayError && todayRides) {
                    const todayTotal = todayRides.reduce((sum, ride) => sum + (ride.driver_earnings || 0), 0);
                    document.getElementById('today-earnings').textContent = todayTotal.toLocaleString();
                }
                
                // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
                const { data: allRides, error: allError } = await supabase
                    .from('rides')
                    .select('driver_earnings, amount')
                    .eq('driver_id', currentDriver.id)
                    .eq('status', 'completed');
                
                if (!allError && allRides) {
                    const totalEarnings = allRides.reduce((sum, ride) => sum + (ride.driver_earnings || 0), 0);
                    const completedTrips = allRides.length;
                    const averageRide = completedTrips > 0 ? Math.round(totalEarnings / completedTrips) : 0;
                    
                    document.getElementById('total-earnings').textContent = totalEarnings.toLocaleString();
                    document.getElementById('completed-trips').textContent = completedTrips;
                    document.getElementById('average-ride').textContent = `${averageRide.toLocaleString()} SDG`;
                    
                    // Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ù„Ø´Ù‡Ø±
                    updateWeeklyMonthlyEarnings();
                }
                
            } catch (error) {
                console.error('Update earnings error:', error);
            }
        }
        
        async function updateWeeklyMonthlyEarnings() {
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            try {
                const { data: weeklyRides, error: weeklyError } = await supabase
                    .from('rides')
                    .select('driver_earnings')
                    .eq('driver_id', currentDriver.id)
                    .gte('completed_at', weekAgo.toISOString())
                    .eq('status', 'completed');
                
                if (!weeklyError && weeklyRides) {
                    const weeklyTotal = weeklyRides.reduce((sum, ride) => sum + (ride.driver_earnings || 0), 0);
                    document.getElementById('weekly-earnings').textContent = `${weeklyTotal.toLocaleString()} SDG`;
                }
                
                const { data: monthlyRides, error: monthlyError } = await supabase
                    .from('rides')
                    .select('driver_earnings')
                    .eq('driver_id', currentDriver.id)
                    .gte('completed_at', monthAgo.toISOString())
                    .eq('status', 'completed');
                
                if (!monthlyError && monthlyRides) {
                    const monthlyTotal = monthlyRides.reduce((sum, ride) => sum + (ride.driver_earnings || 0), 0);
                    document.getElementById('monthly-earnings').textContent = `${monthlyTotal.toLocaleString()} SDG`;
                }
                
            } catch (error) {
                console.error('Update weekly/monthly earnings error:', error);
            }
        }
        
        async function loadRecentTrips() {
            try {
                const { data: rides, error } = await supabase
                    .from('rides')
                    .select('*, customers(full_name)')
                    .eq('driver_id', currentDriver.id)
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                if (error) throw error;
                
                const container = document.getElementById('recent-trips-list');
                
                if (!rides || rides.length === 0) {
                    return;
                }
                
                let html = '';
                
                rides.forEach(ride => {
                    const date = new Date(ride.created_at);
                    const formattedDate = date.toLocaleDateString('ar-SA');
                    const time = date.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
                    
                    html += `
                        <div class="trip-item">
                            <div class="trip-info">
                                <h4>${ride.customers?.full_name || 'Ø²Ø¨ÙˆÙ†'}</h4>
                                <p>${formattedDate} ${time} â€¢ ${getVehicleTypeName(ride.vehicle_type)}</p>
                            </div>
                            <div class="trip-amount">${(ride.driver_earnings || 0).toLocaleString()} SDG</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Load recent trips error:', error);
            }
        }
        
        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
        function toggleDriverStatus() {
            isOnline = !isOnline;
            
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const description = document.getElementById('status-description');
            const toggleBtn = document.getElementById('toggle-status-btn');
            
            if (isOnline) {
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„
                indicator.classList.add('online');
                statusText.textContent = 'Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø²';
                description.textContent = 'Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…ØªØµÙ„ ÙˆØªØ³ØªÙ‚Ø¨Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±ÙƒØ§Ø¨';
                toggleBtn.innerHTML = '<span>ğŸ”´ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„</span>';
                toggleBtn.style.background = '#ef4444';
                
                startLocationTracking();
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„ØŒ Ø¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'success');
                
            } else {
                // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„
                indicator.classList.remove('online');
                statusText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                description.textContent = 'Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±ÙƒØ§Ø¨ØŒ Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„';
                toggleBtn.innerHTML = '<span>âš¡ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„</span>';
                toggleBtn.style.background = 'var(--driver)';
                
                stopLocationTracking();
                showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„', 'info');
            }
        }
        
        // ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        function startLocationTracking() {
            if (!navigator.geolocation) {
                showNotification('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'warning');
                return;
            }
            
            watchId = navigator.geolocation.watchPosition(
                async (position) => {
                    try {
                        await supabase
                            .from('driver_locations')
                            .upsert({
                                driver_id: currentDriver.id,
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                car_type: currentDriver.car_type,
                                last_seen: new Date()
                            }, { onConflict: 'driver_id' });
                    } catch (error) {
                        console.error('Location tracking error:', error);
                    }
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
                },
                { 
                    enableHighAccuracy: true, 
                    maximumAge: 10000, 
                    timeout: 15000 
                }
            );
        }
        
        function stopLocationTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }
        
        // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©
        function subscribeToRideRequests() {
            const channel = supabase
                .channel(`driver-requests-${currentDriver.car_type}`)
                .on('postgres_changes', 
                    { 
                        event: 'INSERT', 
                        schema: 'public', 
                        table: 'rides',
                        filter: `vehicle_type=eq.${currentDriver.car_type}`
                    }, 
                    (payload) => {
                        if (isOnline) {
                            showIncomingRideRequest(payload.new);
                        }
                    }
                )
                .subscribe();
            
            return channel;
        }
        
        function showIncomingRideRequest(rideData) {
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            playNotificationSound();
            
            currentRideId = rideData.id;
            
            const overlay = document.getElementById('incoming-ride-overlay');
            overlay.innerHTML = `
                <div class="modal" style="width: 90%; max-width: 400px;">
                    <div class="countdown" id="ride-countdown">40</div>
                    
                    <div class="modal-header">
                        <h2>ğŸš¨ Ø·Ù„Ø¨ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯!</h2>
                        <p>Ù„Ø¯ÙŠÙƒ 40 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø±Ø¯</p>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span>ÙØ¦Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</span>
                            <strong>${getVehicleTypeName(rideData.vehicle_type)}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:</span>
                            <strong>${(rideData.distance_km || 0).toFixed(1)} ÙƒÙ…</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span>Ø§Ù„Ø²Ø¨ÙˆÙ†:</span>
                            <strong>${rideData.customer_name}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 22px; color: var(--primary); font-weight: bold; padding-top: 15px; border-top: 2px dashed #ddd;">
                            <span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span>
                            <strong>${(rideData.amount || 0).toLocaleString()} SDG</strong>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-driver" onclick="acceptRide()" style="flex: 1; padding: 18px;">
                            <span>âœ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                        </button>
                        <button class="btn" onclick="declineRide()" style="flex: 1; background: #ef4444; padding: 18px;">
                            <span>âŒ Ø±ÙØ¶</span>
                        </button>
                    </div>
                </div>
            `;
            
            overlay.classList.remove('hidden');
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
            startRideCountdown();
        }
        
        function startRideCountdown() {
            let timeLeft = 40;
            const countdownElement = document.getElementById('ride-countdown');
            
            rideCountdownInterval = setInterval(() => {
                timeLeft--;
                countdownElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(rideCountdownInterval);
                    declineRide();
                }
            }, 1000);
        }
        
        async function acceptRide() {
            clearInterval(rideCountdownInterval);
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©
                const { error } = await supabase
                    .from('rides')
                    .update({
                        driver_id: currentDriver.id,
                        driver_name: currentDriver.full_name,
                        driver_phone: currentDriver.whatsapp_number,
                        status: 'driver_accepted',
                        accepted_at: new Date()
                    })
                    .eq('id', currentRideId);
                
                if (error) throw error;
                
                // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨
                document.getElementById('incoming-ride-overlay').classList.add('hidden');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©
                showActiveTrip();
                
                showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Accept ride error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
            }
        }
        
        function declineRide() {
            clearInterval(rideCountdownInterval);
            document.getElementById('incoming-ride-overlay').classList.add('hidden');
            showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚ Ø¢Ø®Ø±', 'info');
        }
        
        async function showActiveTrip() {
            try {
                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©
                const { data: ride, error } = await supabase
                    .from('rides')
                    .select('*, customers(full_name, phone)')
                    .eq('id', currentRideId)
                    .single();
                
                if (error) throw error;
                
                const overlay = document.getElementById('active-trip-overlay');
                overlay.innerHTML = `
                    <div class="modal" style="width: 90%; max-width: 400px;">
                        <div class="modal-header">
                            <h2>ğŸš— Ø§Ù„Ø±Ø­Ù„Ø© Ø³Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù†</h2>
                            <p>Ø§ØªØ¬Ù‡ Ù†Ø­Ùˆ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø²Ø¨ÙˆÙ†</p>
                        </div>
                        
                        <div style="background: #e0e7ff; padding: 20px; border-radius: 15px; margin: 20px 0;">
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Ø§Ù„Ø²Ø¨ÙˆÙ†:</span>
                                    <strong>${ride.customers?.full_name || ride.customer_name}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„:</span>
                                    <strong><a href="tel:${ride.customers?.phone || ride.customer_phone}" style="color: inherit; text-decoration: none;">${ride.customers?.phone || ride.customer_phone}</a></strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>ÙØ¦Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</span>
                                    <strong>${getVehicleTypeName(ride.vehicle_type)}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 22px; color: var(--primary);">
                                    <span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span>
                                    <strong>${ride.amount?.toLocaleString() || 0} SDG</strong>
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 15px;">
                                <div style="font-size: 14px; color: #666;">
                                    Ø³ÙŠØªÙ… Ø®ØµÙ… <strong>6%</strong> Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø©
                                </div>
                                <div style="font-size: 16px; color: var(--driver); margin-top: 5px;">
                                    ØµØ§ÙÙŠ Ø¯Ø®Ù„Ùƒ: <strong>${Math.round(ride.amount * 0.94).toLocaleString()} SDG</strong>
                                </div>
                            </div>
                        </div>
                        
                        <div id="trip-controls">
                            <button onclick="markArrivedAtPickup()" style="background: var(--driver); width: 100%; padding: 18px; font-size: 18px; margin-bottom: 10px;">
                                <span>ğŸ“ ÙˆØµÙ„Øª Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø²Ø¨ÙˆÙ†</span>
                            </button>
                            <button onclick="cancelTrip('driver')" style="background: #6b7280; width: 100%; padding: 15px; margin-bottom: 10px;">
                                <span>âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                            </button>
                        </div>
                    </div>
                `;
                
                overlay.classList.remove('hidden');
                
            } catch (error) {
                console.error('Show active trip error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
            }
        }
        
        async function markArrivedAtPickup() {
            try {
                await supabase
                    .from('rides')
                    .update({
                        status: 'driver_arrived',
                        driver_arrived_at: new Date()
                    })
                    .eq('id', currentRideId);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const controls = document.getElementById('trip-controls');
                controls.innerHTML = `
                    <button onclick="startTrip()" style="background: var(--primary); width: 100%; padding: 18px; font-size: 18px; margin-bottom: 10px;">
                        <span>â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                    </button>
                    <button onclick="cancelTrip('driver')" style="background: #6b7280; width: 100%; padding: 15px;">
                        <span>âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                    </button>
                `;
                
                showNotification('ØªÙ… Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¨ÙˆØµÙˆÙ„Ùƒ', 'success');
                
            } catch (error) {
                console.error('Mark arrived error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©', 'error');
            }
        }
        
        async function startTrip() {
            try {
                await supabase
                    .from('rides')
                    .update({
                        status: 'in_progress',
                        started_at: new Date()
                    })
                    .eq('id', currentRideId);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const controls = document.getElementById('trip-controls');
                controls.innerHTML = `
                    <button onclick="completeTrip()" style="background: var(--success); width: 100%; padding: 18px; font-size: 18px; margin-bottom: 10px;">
                        <span>âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                    </button>
                    <button onclick="cancelTrip('driver')" style="background: #6b7280; width: 100%; padding: 15px;">
                        <span>âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</span>
                    </button>
                `;
                
                showNotification('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©ØŒ Ø§ØªØ¬Ù‡ Ù†Ø­Ùˆ Ø§Ù„ÙˆØ¬Ù‡Ø©', 'info');
                
            } catch (error) {
                console.error('Start trip error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
            }
        }
        
        async function completeTrip() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©ØŸ Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.')) return;
            
            try {
                const { data: ride, error: fetchError } = await supabase
                    .from('rides')
                    .select('amount')
                    .eq('id', currentRideId)
                    .single();
                
                if (fetchError) throw fetchError;
                
                const serviceFee = ride.amount * 0.06;
                const driverEarnings = ride.amount - serviceFee;
                
                // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¦Ù‚
                await supabase
                    .from('drivers')
                    .update({ 
                        balance: currentDriver.balance + driverEarnings 
                    })
                    .eq('id', currentDriver.id);
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©
                await supabase
                    .from('rides')
                    .update({
                        status: 'completed',
                        completed_at: new Date(),
                        service_fee: serviceFee,
                        driver_earnings: driverEarnings
                    })
                    .eq('id', currentRideId);
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                currentDriver.balance += driverEarnings;
                localStorage.setItem('tarhal_driver', JSON.stringify(currentDriver));
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                document.getElementById('active-trip-overlay').classList.add('hidden');
                
                showNotification('ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                loadDriverData();
                updateEarnings();
                loadRecentTrips();
                
            } catch (error) {
                console.error('Complete trip error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
            }
        }
        
        async function cancelTrip(cancelledBy) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©ØŸ')) return;
            
            try {
                await supabase
                    .from('rides')
                    .update({
                        status: 'cancelled',
                        cancelled_by: cancelledBy,
                        cancelled_at: new Date()
                    })
                    .eq('id', currentRideId);
                
                document.getElementById('active-trip-overlay').classList.add('hidden');
                showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'info');
                
            } catch (error) {
                console.error('Cancel trip error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("Sound playback not supported");
            }
        }
        
        function showLocationSettings() {
            showNotification('ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù‡Ø§Ø²Ùƒ', 'info');
        }
        
        function showWithdrawal() {
            const adminNumber = "249XXXXXXXXX";
            const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø³Ø­Ø¨ Ø±ØµÙŠØ¯ÙŠ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„\nØ§Ù„Ø§Ø³Ù…: ${currentDriver.full_name}\nØ±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: ${currentDriver.whatsapp_number}\nØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentDriver.balance} SDG`;
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        function showSupport() {
            const adminNumber = "249XXXXXXXXX";
            const message = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¯Ø¹Ù… ÙÙ†ÙŠ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„ Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†";
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        function showEmergency() {
            const emergencyNumber = "999";
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ØŸ')) {
                window.open(`tel:${emergencyNumber}`, '_self');
            }
        }
        
        function logoutDriver() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŸ')) {
                if (isOnline) {
                    toggleDriverStatus();
                }
                localStorage.removeItem('tarhal_driver');
                window.location.href = 'index.html';
            }
        }
        
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notification-area');
            
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                z-index: 99999;
                animation: slideInRight 0.5s ease;
                border-right: 5px solid ${colors[type] || colors.info};
                max-width: 300px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 24px;">
                        ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; margin-bottom: 5px; color: #1f2937;">
                            ${type === 'success' ? 'Ù†Ø¬Ø§Ø­' : type === 'error' ? 'Ø®Ø·Ø£' : type === 'warning' ? 'ØªØ­Ø°ÙŠØ±' : 'Ù…Ø¹Ù„ÙˆÙ…Ø©'}
                        </div>
                        <div style="color: #4b5563; font-size: 14px;">${message}</div>
                    </div>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.5s ease reverse';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>
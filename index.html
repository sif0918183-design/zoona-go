<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Tarhal</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <link rel="icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <!-- Tajawal Font -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Ionicons Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <!-- Firebase for Notifications -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #e0e7ff;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --warning: #f59e0b;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --light: #f9fafb;
            --dark: #111827;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            
            --driver: #16a34a;
            --tuk-tuk: #059669;
            --economy: #2563eb;
            --comfort: #7c3aed;
            --vip: #d97706;
            --staff: #7c3aed;
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* ØªØµÙÙŠØ± Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© â€” Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

/* Body */
body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--dark);
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Container */
.app-container {
    max-width: 500px;
    margin: 0 auto;
    min-height: 100vh;
    background: var(--light);
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.1);
    position: relative;
}

/* Header */
.app-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 2px;
    text-align: center;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 9999;
    border-bottom: 4px solid var(--primary-dark);
}

/* ğŸ”´ Ù‡Ø°Ø§ ÙƒØ§Ù† Ø³Ø¨Ø¨ Ø§Ù„ÙØ±Ø§Øº Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ§Ù„Ø£Ø³ÙÙ„ */
.app-header h1 {
    margin: 0;              /* Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ */
    padding: 0;
    font-size: 24px;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    line-height: 1.2;       /* ÙŠÙ…Ù†Ø¹ ÙØ±Ø§Øº Ø¹Ù…ÙˆØ¯ÙŠ Ø®ÙÙŠ */
}

/* Logo */
.app-header .logo {
    max-height: 50px;
    width: auto;
    padding: 0;
    display: block;
}
        
        /* Screens */
        .screen {
            padding: 0;
            min-height: calc(100vh - 76px);
            display: flex;
            flex-direction: column;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Buttons */
        .btn {
            padding: 16px 24px;
            border-radius: var(--radius);
            border: none;
            font-family: 'Tajawal', sans-serif;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 12px;
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--secondary-dark);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-driver {
            background: var(--driver);
            color: white;
        }
        
        .btn-driver:hover {
            background: #15803d;
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary-light);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: var(--danger-dark);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-input::placeholder {
            color: var(--gray);
        }
        
        /* Welcome Screen */
        .welcome-card {
            text-align: center;
            padding: 40px 24px;
            background: linear-gradient(135deg, #e0e7ff 0%, #ede9fe 100%);
            border: none;
            margin-top: 40px;
        }
        
        .welcome-icon {
            font-size: 64px;
            margin-bottom: 24px;
            color: var(--primary);
        }
        
        .welcome-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .welcome-subtitle {
            color: var(--gray);
            font-size: 16px;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .role-selection {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .role-card {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: right;
        }
        
        .role-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .role-icon {
            font-size: 32px;
            color: var(--primary);
        }
        
        .role-info h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--dark);
        }
        
        .role-info p {
            font-size: 14px;
            color: var(--gray);
            line-height: 1.5;
        }
        
        /* Login Screens */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
        }
        
        .form-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .form-footer .register-text {
            margin-bottom: 20px;
        }
        
        .form-footer .register-text a {
            display: inline;
        }
        
        .form-footer .back-link {
            display: inline-flex;
            justify-content: center;
            margin-top: 8px;
            padding: 10px 16px;
            border-radius: 12px;
            background: #f1f2ff;
            font-size: 14px;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            border-right: 4px solid var(--primary);
            animation: slideIn 0.3s ease;
            max-width: 500px;
            margin: 0 auto;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .notification-icon {
            font-size: 24px;
        }
        
        .notification-success {
            border-right-color: var(--secondary);
        }
        
        .notification-error {
            border-right-color: var(--danger);
        }
        
        .notification-warning {
            border-right-color: var(--warning);
        }
        
        /* Overlay Modals */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: white;
            border-radius: var(--radius-xl);
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(40px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .modal-subtitle {
            color: var(--gray);
            font-size: 16px;
        }
        
        /* Home Screen */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
        }
        
        .user-info h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--dark);
        }
        
        .user-info p {
            color: var(--gray);
            font-size: 14px;
        }
        
        .verified-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 9px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .home-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .action-card {
            background: white;
            border-radius: var(--radius);
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--gray-light);
        }
        
        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--primary-light);
        }
        
        .action-icon {
            font-size: 28px;
            margin-bottom: 9px;
            color: var(--primary);
        }
        
        .action-card h4 {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Ride Request - Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© */
        .ride-screen-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 9999;
            box-shadow: var(--shadow);
        }
        
        .ride-screen-header h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }
        
        .ride-screen-header .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: var(--radius);
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .ride-screen-header .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .ride-screen-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        
        .map-wrapper {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid var(--gray-light);
            margin-bottom: 20px;
        }
        
        .map-container {
            width: 100%;
            height: 350px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
        }
        
        .map-controls-top {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .map-control-btn {
            width: 45px;
            height: 45px;
            background: white;
            border: 2px solid var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            color: var(--primary);
            font-size: 20px;
        }
        
        .map-control-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .start-marker {
            background: #4f46e5;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .end-marker {
            background: #ef4444;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .route-info-card {
            border-right: 4px solid var(--primary);
            background: #f8fafc;
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 20px;
        }
        
        .route-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .route-detail-item:last-child {
            border-bottom: none;
        }
        
        .route-detail-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .route-detail-value {
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Driver Dashboard */
        .driver-status {
            background: var(--light);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .status-offline {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .status-online {
            background: #dcfce7;
            color: var(--secondary-dark);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-offline .status-dot {
            background: var(--danger);
        }
        
        .status-online .status-dot {
            background: var(--secondary);
        }
        
        .driver-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            border: 1px solid var(--gray-light);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .ride-screen-content {
                padding: 16px;
            }
            
            .map-container {
                height: 300px;
            }
            
            .map-control-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .home-actions {
                grid-template-columns: 1fr;
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 8px; }
        .mb-2 { margin-bottom: 16px; }
        .mb-3 { margin-bottom: 24px; }
        .mt-1 { margin-top: 8px; }
        .mt-2 { margin-top: 16px; }
        .mt-3 { margin-top: 24px; }
        .p-1 { padding: 8px; }
        .p-2 { padding: 16px; }
        .p-3 { padding: 24px; }
        
        /* PWA Install Prompt */
        #pwa-install-prompt {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideUp 0.3s ease;
        }
        
        .pwa-mode .app-header {
            padding-top: env(safe-area-inset-top, 20px);
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-img {
            width: 70px;
            height: 70px;
            object-fit: contain;
        }
        
        /* In-app Notification */
        .in-app-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 99999;
            animation: slideDown 0.3s ease;
            border-right: 4px solid #4f46e5;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Notification Activation Modal */
        #notification-activation-prompt {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        /* Sound Control */
        .sound-control-panel {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 1000;
        }
        
        #volume-slider {
            display: none;
            margin-top: 10px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© */
        .location-mode-btn.active {
            background: #4f46e5 !important;
            color: white !important;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
            100% {
                transform: scale(1);
                opacity: 0.7;
            }
        }

        .pulsing-marker {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash-screen">
  <div class="splash-content">

    <div class="pulse-ring"></div>

    <img src="icons/icon-512x512.png" alt="Tarhal Zoona Logo" class="splash-logo">

    <div class="loader"></div>
    <p class="splash-text">Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§â€¦</p>

  </div>
</div>

<style>
/* ===============================
   Splash Screen - Zoona Theme
================================ */

#splash-screen {
  position: fixed;
  inset: 0;
  background: linear-gradient(
    135deg,
    #4338ca,
    #4f46e5,
    #6366f1
  );
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999999;
  transition: opacity 0.6s ease, visibility 0.6s ease;
}

.splash-content {
  text-align: center;
  position: relative;
}

/* Logo */
.splash-logo {
  width: 180px;
  max-width: 70vw;
  height: auto;
  position: relative;
  z-index: 2;
  animation: logoIn 0.9s ease;
}

/* Pulse Ring (Ø­ÙˆÙ„ Ø§Ù„Ø´Ø¹Ø§Ø±) */
.pulse-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 230px;
  height: 230px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.18);
  transform: translate(-50%, -50%);
  animation: pulse 1.9s infinite;
  z-index: 1;
}

/* Loader */
.loader {
  margin: 26px auto 10px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 4px solid rgba(255,255,255,0.35);
  border-top-color: #ffffff;
  animation: spin 0.9s linear infinite;
}

/* Text */
.splash-text {
  font-family: "Tajawal", system-ui, sans-serif;
  font-size: 14px;
  color: #eef2ff;
  letter-spacing: 0.4px;
}

/* Animations */
@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes pulse {
  0% {
    transform: translate(-50%, -50%) scale(0.9);
    opacity: 0.6;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.25);
    opacity: 0;
  }
}

@keyframes logoIn {
  from {
    transform: scale(0.85);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Hide Splash */
#splash-screen.hide {
  opacity: 0;
  visibility: hidden;
}
</style>

<script>
/* Ø¥Ø®ÙØ§Ø¡ Splash Ø¨Ø¹Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("splash-screen").classList.add("hide");
  }, 900);
});
</script>

    <!-- Notification Activation Modal (Dynamic) -->
    <div id="notification-activation-modal"></div>
    
    <!-- Sound Control Panel -->
    <div class="sound-control-panel">
        <button id="sound-toggle" onclick="toggleAppSound()" 
                style="width: 50px; height: 50px; border-radius: 50%; 
                       background: #4f46e5; border: none; color: white;
                       display: flex; align-items: center; justify-content: center;
                       cursor: pointer; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);">
            <ion-icon name="volume-high" id="sound-icon" style="font-size: 24px;"></ion-icon>
        </button>
        
        <div id="volume-slider">
            <input type="range" min="0" max="100" value="70" 
                   oninput="changeVolume(this.value)" style="width: 100%;">
        </div>
    </div>
    
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-title">
                <img 
                    src="icons/icon-512x512.png" 
                    alt="ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†" 
                    class="logo-img"
                >
                ØªØ±Ø­Ù€Ù€Ø§Ù„ Ø²ÙˆÙ†Ù€Ù€Ø§
            </h1>
        </header>
        
        <!-- Welcome Screen -->
        <section id="welcome-screen" class="screen">
            <div class="welcome-card card">
                <h1 class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§</h1>
                <p class="welcome-subtitle">
                    ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†. Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø¨Ø¯Ø¡
                </p>
                
                <div class="role-selection">
                    <!-- Ø·Ø§Ù„Ø¨ Ø±Ø­Ù„Ø© -->
                    <div class="role-card" onclick="showCustomerLogin()">
                        <div class="role-icon">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div class="role-info">
                            <h3>Ø·Ø§Ù„Ø¨ Ø±Ø­Ù„Ø©</h3>
                            <p>Ø§Ø·Ù„Ø¨ Ø±Ø­Ù„Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù† Ù…Ù† Ø£Ù‚Ø±Ø¨ Ø³Ø§Ø¦Ù‚ Ù„Ùƒ</p>
                        </div>
                        <ion-icon name="chevron-forward-outline"></ion-icon>
                    </div>

                    <!-- Ø³Ø§Ø¦Ù‚ -->
                    <div class="role-card" onclick="showDriverLogin()">
                        <div class="role-icon">
                            <i class="fa-solid fa-car"></i>
                        </div>
                        <div class="role-info">
                            <h3>Ø³Ø§Ø¦Ù‚</h3>
                            <p>Ø§Ù†Ø¶Ù… ÙƒØ³Ø§Ø¦Ù‚ ÙˆØ§Ø¨Ø¯Ø£ ÙƒØ³Ø¨ Ø§Ù„Ù…Ø§Ù„ Ù…Ø¹ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§</p>
                        </div>
                        <ion-icon name="chevron-forward-outline"></ion-icon>
                    </div>

                    <div class="form-footer mt-3">
                        <a href="/admin-login.html">
                            <ion-icon name="shield-checkmark-outline"></ion-icon>
                            Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Customer Login -->
        <section id="customer-login-screen" class="screen hidden">
            <div class="card">
                <h2 class="card-title">
                    <ion-icon name="person-circle-outline"></ion-icon>
                    Ø¯Ø®ÙˆÙ„ Ø·Ø§Ù„Ø¨ Ø§Ù„Ø±Ø­Ù„Ø©
                </h2>
                
                <form class="login-form" id="customerLoginForm">
                    <div class="form-group">
                        <label class="form-label" for="customer-phone">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                        <input type="tel" id="customer-phone" class="form-input" 
                               placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="customer-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="customer-password" class="form-input" 
                               placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="loginCustomer()">
                        <ion-icon name="log-in-outline"></ion-icon>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
                
                <div class="form-footer">
                    <p class="register-text">
                        Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ
                        <a href="#" onclick="showCustomerRegister()">Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†</a>
                    </p>

                    <a href="#" class="back-link" onclick="showWelcomeScreen()">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Customer Registration -->
        <section id="customer-register-screen" class="screen hidden">
            <div class="card">
                <h2 class="card-title">
                    <ion-icon name="person-add-outline"></ion-icon>
                    ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                </h2>
                
                <form class="login-form" id="customerRegisterForm">
                    <div class="form-group">
                        <label class="form-label" for="register-fullname">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
                        <input type="text" id="register-fullname" class="form-input" 
                               placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="register-phone">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                        <input type="tel" id="register-phone" class="form-input" 
                               placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ù„Ù„ØªØ³Ø¬ÙŠÙ„)" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="register-phone2">Ø±Ù‚Ù… Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="tel" id="register-phone2" class="form-input" 
                               placeholder="Ø±Ù‚Ù… Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªÙˆØ§ØµÙ„">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="register-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="register-password" class="form-input" 
                               placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="registerCustomer()">
                        <ion-icon name="create-outline"></ion-icon>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                    </button>
                </form>
                
                <div id="verification-section" class="hidden mt-3">
                    <div class="card" style="background: #f0f9ff; border: 2px dashed var(--secondary);">
                        <h3 class="mb-2" style="color: var(--secondary);">
                            <ion-icon name="checkmark-circle-outline"></ion-icon>
                            ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!
                        </h3>
                        <p class="mb-2">Ù„ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯:</p>
                        
                        <button type="button" class="btn btn-secondary" onclick="sendVerificationWhatsApp()">
                            <ion-icon name="logo-whatsapp"></ion-icon>
                            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                        </button>
                        
                        <p class="mt-2" style="font-size: 14px; color: var(--gray);">
                            Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚
                        </p>
                    </div>
                </div>
                
                <div class="form-footer mt-3">
                    <a href="#" onclick="showCustomerLogin()">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Driver Login -->
        <section id="driver-login-screen" class="screen hidden">
            <div class="card">
                <h2 class="card-title">
                    <ion-icon name="car-sport-outline"></ion-icon>
                    Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
                </h2>
                
                <form class="login-form" id="driverLoginForm">
                    <div class="form-group">
                        <label class="form-label" for="driver-phone">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¦Ù‚</label>
                        <input type="tel" id="driver-phone" class="form-input" 
                               placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="driver-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="driver-password" class="form-input" 
                               placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø³Ø§Ø¦Ù‚" required>
                    </div>
                    
                    <button type="button" class="btn btn-driver" onclick="loginDriver()">
                        <ion-icon name="log-in-outline"></ion-icon>
                        Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚
                    </button>
                </form>
                
                <div class="form-footer">
                    <p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¦Ù‚ØŸ 
                        <a href="#" onclick="showDriverRegisterInfo()">Ø³Ø¬Ù„ ÙƒØ³Ø§Ø¦Ù‚ Ø§Ù„Ø¢Ù†</a>
                    </p>
                    <a href="#" onclick="showWelcomeScreen()">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Driver Registration Info -->
        <section id="driver-register-info-screen" class="screen hidden">
            <div class="card">
                <h2 class="card-title">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒØ³Ø§Ø¦Ù‚
                </h2>
                
                <div class="mb-3">
                    <p>Ù„Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒØ³Ø§Ø¦Ù‚ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¥Ø¯Ø§Ø±ØªÙ†Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</p>
                    
                    <div class="p-3" style="background: #f0f9ff; border-radius: var(--radius); margin: 20px 0;">
                        <h4 class="mb-2" style="color: var(--primary);">Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</h4>
                        <ul style="padding-right: 20px; line-height: 1.8;">
                            <li>Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø§Ø±ÙŠØ©</li>
                            <li>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</li>
                            <li>ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</li>
                            <li>ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬</li>
                            <li>ØµÙˆØ±Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</li>
                        </ul>
                    </div>
                </div>
                
                <button type="button" class="btn btn-driver" onclick="contactAdminForDriverRegistration()">
                    <ion-icon name="logo-whatsapp"></ion-icon>
                    Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
                </button>
                
                <div class="form-footer mt-3">
                    <a href="#" onclick="showDriverLogin()">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Home Screen (After Login) -->
        <section id="home-screen" class="screen hidden">
            <div class="card">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">?</div>
                    <div class="user-info">
                        <h3 id="user-name">Ù…Ø±Ø­Ø¨Ø§Ù‹</h3>
                        <p id="user-phone-display"></p>
                        <div id="verification-status" class="hidden mt-1">
                            <span class="verified-badge">
                                <ion-icon name="checkmark-circle"></ion-icon>
                                Ø­Ø³Ø§Ø¨ Ù…ÙˆØ«Ù‚
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="home-actions">
                    <div class="action-card" onclick="requestRide()">
                        <div class="action-icon">ğŸš—</div>
                        <h4>Ø·Ù„Ø¨ Ø±Ø­Ù„Ø©</h4>
                    </div>
                    
                    <div class="action-card" onclick="showMyRides()">
                        <div class="action-icon">ğŸ“‹</div>
                        <h4>Ø±Ø­Ù„Ø§ØªÙŠ</h4>
                    </div>
                    
                    <div class="action-card" onclick="showWallet()">
                        <div class="action-icon">ğŸ’°</div>
                        <h4>Ø§Ù„Ù…Ø­ÙØ¸Ø©</h4>
                    </div>
                    
                    <div class="action-card" onclick="showSettings()">
                        <div class="action-icon">âš™ï¸</div>
                        <h4>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h4>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="testAdvancedNotifications()" style="margin-top: 20px;">
                    <ion-icon name="notifications-outline"></ion-icon>
                     Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </button>
                
                <button id="driver-notification-btn" class="btn btn-secondary mt-2 hidden" onclick="setupDriverNotifications()">
                    <ion-icon name="notifications"></ion-icon>
                     ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
                </button>
                
                <button class="btn btn-outline mt-3" onclick="logout()">
                    <ion-icon name="log-out-outline"></ion-icon>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </section>
        
        <!-- Ride Request Screen -->
        <section id="ride-request-screen" class="screen hidden">
            <div class="ride-screen-header">
                <button class="back-btn" onclick="goHome()">
                    <ion-icon name="arrow-back-outline"></ion-icon>
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <h2>Ø·Ù„Ø¨ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <div style="width: 50px;"></div> <!-- Ø¹Ù†ØµØ± ÙØ§Ø±Øº Ù„Ù„Ù…Ø³Ø§ÙˆØ§Ø© -->
            </div>
            
            <div class="ride-screen-content">
                <!-- Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙˆÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
                <div style="
                    background: #f0f9ff;
                    border: 2px solid #bae6fd;
                    border-radius: 12px;
                    padding: 12px 16px;
                    margin-bottom: 16px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    flex-wrap: wrap;
                    gap: 10px;
                ">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <ion-icon name="information-circle" style="color: #0ea5e9; font-size: 20px;"></ion-icon>
                        <span style="font-weight: 600; color: #0369a1;">ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù†Ù‚Ø·Ø© A Ù‡ÙŠ Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                    </div>
                    
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span style="font-size: 14px; color: #475569;">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A:</span>
                        <div style="
                            background: white;
                            border-radius: 20px;
                            border: 2px solid #e2e8f0;
                            display: flex;
                            overflow: hidden;
                        ">
                            <button id="auto-mode-btn" class="location-mode-btn active" onclick="setLocationMode('auto')" style="
                                padding: 8px 16px;
                                border: none;
                                background: #4f46e5;
                                color: white;
                                font-family: 'Tajawal';
                                font-size: 14px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">
                                ØªÙ„Ù‚Ø§Ø¦ÙŠ
                            </button>
                            <button id="manual-mode-btn" class="location-mode-btn" onclick="setLocationMode('manual')" style="
                                padding: 8px 16px;
                                border: none;
                                background: #f1f5f9;
                                color: #64748b;
                                font-family: 'Tajawal';
                                font-size: 14px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">
                                ÙŠØ¯ÙˆÙŠ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
                <div class="map-wrapper">
                    <div class="map-container" id="ride-map">
                        <!-- Ø³ÙŠØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù‡Ù†Ø§ -->
                    </div>
                    
                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…ÙƒØ§Ù† Ø¬Ø¯ÙŠØ¯ -->
                    <div class="map-controls-top">
                        <button class="map-control-btn" onclick="recenterMap()" title="ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ">
                            <ion-icon name="locate-outline"></ion-icon>
                        </button>
                        <button class="map-control-btn" onclick="refreshLocation()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹">
                            <ion-icon name="refresh-outline"></ion-icon>
                        </button>
                    </div>
                    
                    <!-- Ø²Ø± Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ù‡Ø© -->
                    <div id="destination-clear-btn" class="hidden" style="position: absolute; top: 15px; right: 15px; z-index: 1000;">
                        <button onclick="clearDestination()" style="
                            background: var(--danger);
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-family: 'Tajawal';
                            font-size: 14px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 5px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                        ">
                            <ion-icon name="close-circle-outline"></ion-icon>
                            Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ù‡Ø©
                        </button>
                    </div>
                </div>
                
                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                <div id="route-details-section" class="hidden">
                    <div class="route-info-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="color: var(--primary); font-weight: 700; margin: 0;">
                                <ion-icon name="navigate-outline" style="vertical-align: middle;"></ion-icon>
                                ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø±
                            </h4>
                            <div style="font-size: 12px; color: var(--gray);">
                                <ion-icon name="time-outline" style="vertical-align: middle;"></ion-icon>
                                <span id="route-duration">0</span> Ø¯Ù‚ÙŠÙ‚Ø©
                            </div>
                        </div>
                        
                        <div id="route-info-content">
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                        </div>
                    </div>
                </div>
                
                <div style="
                    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                    border-radius: var(--radius);
                    padding: 16px;
                    margin-bottom: 16px;
                    border: 2px solid #e2e8f0;
                ">
                    <h4 class="form-label" style="
                        color: #334155;
                        font-weight: 700;
                        font-size: 16px;
                        margin-bottom: 16px;
                        text-align: center;
                    ">
                        <ion-icon name="car-outline" style="vertical-align: middle; margin-left: 8px;"></ion-icon>
                        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                    </h4>
                    <div class="vehicle-options" style="
  display: grid;
  grid-template-columns: repeat(4, auto);
  gap: 8px;
  justify-content: center;
  align-items: stretch;
  margin-bottom: 0;
">
                        <div class="vehicle-option" data-type="tuktuk" onclick="selectVehicle('tuktuk')" style="
                            border: 2px solid var(--gray-light);
                            border-radius: 10px;
                            padding: 12px 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: white;
                        ">
                            <div class="vehicle-icon" style="font-size: 20px; margin-bottom: 6px;">ğŸ›º</div>
                            <div class="vehicle-name" style="font-weight: 700; margin-bottom: 4px; font-size: 12px;">Ø±ÙƒÙ€Ù€Ø´Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø©</div>
                            <div class="vehicle-price" style="color: var(--primary); font-weight: 800; font-size: 14px;">5,000</div>
                        </div>
                        
                        <div class="vehicle-option" data-type="economy" onclick="selectVehicle('economy')" style="
                            border: 2px solid var(--gray-light);
                            border-radius: 10px;
                            padding: 12px 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: white;
                        ">
                            <div class="vehicle-icon" style="font-size: 20px; margin-bottom: 6px;">ğŸš—</div>
                            <div class="vehicle-name" style="font-weight: 700; margin-bottom: 4px; font-size: 12px;">Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</div>
                            <div class="vehicle-price" style="color: var(--primary); font-weight: 800; font-size: 14px;">6,000</div>
                        </div>
                        
                        <div class="vehicle-option" data-type="comfort" onclick="selectVehicle('comfort')" style="
                            border: 2px solid var(--gray-light);
                            border-radius: 10px;
                            padding: 12px 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: white;
                        ">
                            <div class="vehicle-icon" style="font-size: 20px; margin-bottom: 6px;">ğŸš™</div>
                            <div class="vehicle-name" style="font-weight: 700; margin-bottom: 4px; font-size: 12px;">Ù…ØªÙˆØ³Ø·Ø©</div>
                            <div class="vehicle-price" style="color: var(--primary); font-weight: 800; font-size: 14px;">7,000</div>
                        </div>
                        
                        <div class="vehicle-option" data-type="vip" onclick="selectVehicle('vip')" style="
                            border: 2px solid var(--gray-light);
                            border-radius: 10px;
                            padding: 12px 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: white;
                        ">
                            <div class="vehicle-icon" style="font-size: 20px; margin-bottom: 6px;">â­</div>
                            <div class="vehicle-name" style="font-weight: 700; margin-bottom: 4px; font-size: 12px;">VIP</div>
                            <div class="vehicle-price" style="color: var(--primary); font-weight: 800; font-size: 14px;">10,000</div>
                        </div>
                    </div>
                </div>
                
                <div id="price-calculation" class="price-breakdown hidden" style="
                    background: var(--light);
                    border-radius: var(--radius);
                    padding: 20px;
                    margin-bottom: 24px;
                ">
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø§Ù„Ù…Ø³Ø§ÙØ©:</span>
                        <span id="distance-display">0 km</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
                        <span id="base-price-display">0 SDG</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©:</span>
                        <span id="extra-price-display">0 SDG</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: none; font-weight: 800; font-size: 20px; color: var(--primary);">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span id="total-price-display">0 SDG</span>
                    </div>
                </div>
                
                <button id="confirm-ride-btn" class="btn btn-primary" onclick="confirmRide()" disabled>
                    <ion-icon name="search-outline"></ion-icon>
                    Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚
                </button>
            </div>
        </section>
        
        <!-- Driver Dashboard -->
        <section id="driver-dashboard-screen" class="screen hidden">
            <div class="card">
                <div class="user-profile">
                    <div class="user-avatar" id="driver-avatar">?</div>
                    <div class="user-info">
                        <h3 id="driver-name">Ø³Ø§Ø¦Ù‚</h3>
                        <p id="driver-car-info">Ù…Ø±ÙƒØ¨Ø©</p>
                    </div>
                </div>
                
                <div class="driver-status">
                    <div id="driver-status-indicator" class="status-indicator status-offline">
                        <span class="status-dot"></span>
                        <span id="driver-status-text">ØºÙŠØ± Ù…ØªØµÙ„</span>
                    </div>
                    
                    <button id="toggle-online-btn" class="btn btn-driver" onclick="toggleDriverStatus()">
                        <ion-icon name="power-outline"></ion-icon>
                        ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„
                    </button>
                </div>
                
                <div class="driver-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="driver-balance">0</div>
                        <div class="stat-label">Ø±ØµÙŠØ¯Ùƒ (SDG)</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="today-trips">0</div>
                        <div class="stat-label">Ø±Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="today-earnings">0</div>
                        <div class="stat-label">Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="total-trips">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª</div>
                    </div>
                </div>
                
                <!-- Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
                <button id="driver-notification-activation" class="btn btn-secondary" onclick="setupDriverNotifications()">
                    <ion-icon name="notifications-outline"></ion-icon>
                    ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª
                </button>
                
                <button class="btn btn-outline mt-2" onclick="showDriverProfile()">
                    <ion-icon name="person-outline"></ion-icon>
                    Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                </button>
                
                <button class="btn btn-outline mt-2" onclick="logoutDriver()">
                    <ion-icon name="log-out-outline"></ion-icon>
                    ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ø§Ø¦Ù‚
                </button>
            </div>
        </section>
    </div>
    
    <!-- PWA Install Prompt -->
    <div id="pwa-install-prompt" style="display: none; position: fixed; bottom: 20px; left: 20px; right: 20px; background: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000;">
        <div style="text-align: center;">
            <h4 style="margin-bottom: 8px; color: var(--primary);">ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„</h4>
            <p style="margin-bottom: 16px; color: var(--gray); font-size: 14px;">
                Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©
            </p>
            <div style="display: flex; gap: 8px;">
                <button onclick="installPWA()" style="flex: 1; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-family: 'Tajawal'; font-weight: 700;">
                    ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù†
                </button>
                <button onclick="hideInstallPrompt()" style="flex: 1; padding: 12px; background: transparent; color: var(--gray); border: 1px solid var(--gray-light); border-radius: 8px; font-family: 'Tajawal';">
                    Ù„Ø§Ø­Ù‚Ø§Ù‹
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="notification-area"></div>
    
    <!-- Ride Request Modal (For Driver) -->
    <div id="incoming-ride-modal" class="overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                <h2 class="modal-title">Ø·Ù„Ø¨ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯!</h2>
                <p class="modal-subtitle">Ù„Ø¯ÙŠÙƒ 40 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø±Ø¯</p>
            </div>
            
            <div class="card" style="background: #fef2f2;">
                <div id="ride-details">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ù‡Ù†Ø§ -->
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-driver" onclick="acceptRide()" style="flex: 1;">
                    <ion-icon name="checkmark-outline"></ion-icon>
                    Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©
                </button>
                <button class="btn btn-danger" onclick="declineRide()" style="flex: 1;">
                    <ion-icon name="close-outline"></ion-icon>
                    Ø±ÙØ¶
                </button>
            </div>
            
            <div class="countdown" style="text-align: center; font-size: 32px; font-weight: 800; color: var(--danger); margin-top: 20px;">
                40
            </div>
        </div>
    </div>
    
    <!-- Active Trip Modal -->
    <div id="active-trip-modal" class="overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                <h2 class="modal-title">Ø§Ù„Ø±Ø­Ù„Ø© Ø³Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù†</h2>
            </div>
            
            <div id="trip-details">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        // --- Supabase Configuration ---
        const SB_URL = 'https://zsmlyiygjagmhnglrhoa.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzbWx5aXlnamFnbWhuZ2xyaG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NDc3NjMsImV4cCI6MjA4MTUyMzc2M30.QviVinAng-ILq0umvI5UZCFEvNpP3nI0kW_hSaXxNps';
        
        const tarhalDB = supabase.createClient(SB_URL, SB_KEY);
        
        // --- Application State ---
        let currentUser = null;
        let currentDriver = null;
        let isDriverOnline = false;
        let selectedVehicleType = null;
        let rideMap = null;
        let startMarker = null;
        let endMarker = null;
        let userPosition = null;
        let destinationPosition = null;
        let currentRideId = null;
        let rideCountdownInterval = null;
        let rideTimeout = 40;
        let registeredPhone = null;
        let deferredPrompt = null;
        let routePolyline = null;
        let currentRoute = null;
        let routeCalculated = false;
        
        // --- New Variables for Location Mode ---
        let locationMode = 'auto'; // 'auto' or 'manual'
        let manualModeActive = false;
        let manualClickCount = 0;
        let pulsingMarker = null;
        let pulseInterval = null;
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        let notificationManager = null;
        let soundManager = null;
        
        // Vehicle prices
        const VEHICLE_PRICES = {
            tuktuk: { base: 5000, perKm: 2000, name: 'Ø±ÙƒØ´Ù€Ù€Ù€Ù€Ù€Ù€Ø©', icon: 'ğŸ›º' },
            economy: { base: 6000, perKm: 3000, name: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©', icon: 'ğŸš—' },
            comfort: { base: 7000, perKm: 3500, name: 'Ù…ØªÙˆØ³Ø·Ø©', icon: 'ğŸš™' },
            vip: { base: 10000, perKm: 5000, name: 'VIP', icon: 'â­' }
        };
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§ - ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            initPWA();
            checkAuth();
            
            // ØªØ­Ù…ÙŠÙ„ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                loadNotificationSystem();
            }, 1000);
        });
        
        // --- Ù†Ø¸Ø§Ù… PWA Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ---
        async function initPWA() {
            if (!('serviceWorker' in navigator)) return;

            try {
                const registration = await navigator.serviceWorker.register(
                    '/service-worker.js',
                    { scope: '/' }
                );

                console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­');

                // ğŸ”„ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ÙƒÙ„ ÙØªØ­
                registration.update();

                // ØªØ­Ù…ÙŠÙ„ Firebase Messaging
                await loadFirebase();

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ«Ø¨ÙŠØª PWA
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                setTimeout(() => {
                    if (deferredPrompt) {
                        showInstallPrompt();
                    }
                }, 5000);
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('âœ… PWA Ù…Ø«Ø¨Øª');
                localStorage.setItem('pwa_installed', 'true');
                showNotification('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            });
        }
        
        async function loadFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyBxQLDLqr4W3lApfYLPjSV5It7925a9Rr0",
                    authDomain: "double-carport-476915-j7.firebaseapp.com",
                    projectId: "double-carport-476915-j7",
                    storageBucket: "double-carport-476915-j7.firebasestorage.app",
                    messagingSenderId: "122641462099",
                    appId: "1:122641462099:web:345b777a88757d3ef7e7a6"
                };
                
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(firebaseConfig);
                }
                console.log('âœ… Firebase Ù…Ù‡ÙŠØ£');
            } catch (error) {
                console.log('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Firebase');
            }
        }
        
        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ---
        async function loadNotificationSystem() {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                notificationManager = new TarhalNotificationManager();
                await notificationManager.initialize();
                window.notificationManager = notificationManager;
                
                console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø§Ù‡Ø²');
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª
                soundManager = new TarhalSoundManager();
                window.soundManager = soundManager;
                
                // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                if (!localStorage.getItem('tarhal_notifications_asked')) {
                    setTimeout(() => {
                        notificationManager.showActivationPrompt();
                    }, 3000);
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', error);
            }
        }
        
        // --- PWA Functions ---
        function showInstallPrompt() {
            const prompt = document.getElementById('pwa-install-prompt');
            if (prompt) {
                prompt.style.display = 'block';
            }
        }
        
        function hideInstallPrompt() {
            const prompt = document.getElementById('pwa-install-prompt');
            if (prompt) {
                prompt.style.display = 'none';
            }
        }
        
        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    showNotification('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                }
                
                deferredPrompt = null;
                hideInstallPrompt();
            }
        }
        
        // --- Screen Navigation ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
            if (screenId === 'driver-dashboard-screen') {
                updateDriverUI();
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø­Ù„Ø©
            if (screenId === 'ride-request-screen' && rideMap) {
                setTimeout(() => {
                    rideMap.invalidateSize();
                }, 300);
            }
        }
        
        function showWelcomeScreen() {
            showScreen('welcome-screen');
        }
        
        function showCustomerLogin() {
            showScreen('customer-login-screen');
            document.getElementById('customer-phone').focus();
        }
        
        function showCustomerRegister() {
            showScreen('customer-register-screen');
            document.getElementById('verification-section').classList.add('hidden');
            document.getElementById('register-fullname').focus();
            document.getElementById('customerRegisterForm').style.opacity = '1';
            document.querySelector('#customerRegisterForm button').disabled = false;
        }
        
        function showDriverLogin() {
            showScreen('driver-login-screen');
            document.getElementById('driver-phone').focus();
        }
        
        function showDriverRegisterInfo() {
            showScreen('driver-register-info-screen');
        }
        
        function goHome() {
            if (currentUser) {
                showScreen('home-screen');
            } else if (currentDriver) {
                showScreen('driver-dashboard-screen');
            } else {
                showScreen('welcome-screen');
            }
        }
        
        // --- ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ---
        function updateDriverUI() {
            if (currentDriver) {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
                const notificationBtn = document.getElementById('driver-notification-activation');
                if (notificationBtn && Notification.permission !== 'granted') {
                    notificationBtn.classList.remove('hidden');
                }
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                const testBtn = document.getElementById('driver-notification-btn');
                if (testBtn) {
                    testBtn.classList.remove('hidden');
                }
            }
        }
        
        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ---
        async function testAdvancedNotifications() {
            if (notificationManager) {
                await notificationManager.sendTestNotification();
            } else {
                showNotification('âš ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø¬Ø§Ù‡Ø² Ø¨Ø¹Ø¯', 'warning');
            }
        }
        
        async function setupDriverNotifications() {
            if (!notificationManager) {
                showNotification('âš ï¸ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...', 'warning');
                await loadNotificationSystem();
            }
            
            if (notificationManager) {
                await notificationManager.enableAllFeatures();
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø³Ø§Ø¦Ù‚Ø§Ù‹ØŒ ØªØ³Ø¬ÙŠÙ„Ù‡ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                if (currentDriver) {
                    await registerDriverForNotifications();
                }
            }
        }
        
        async function registerDriverForNotifications() {
            try {
                if (currentDriver && notificationManager) {
                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    const permission = await Notification.requestPermission();
                    
                    if (permission === 'granted') {
                        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                        await tarhalDB
                            .from('driver_notifications')
                            .upsert({
                                driver_id: currentDriver.id,
                                notification_enabled: true,
                                last_active: new Date().toISOString()
                            }, { onConflict: 'driver_id' });
                        
                        showNotification('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        
                        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„
                        const btn = document.getElementById('driver-notification-activation');
                        if (btn) btn.classList.add('hidden');
                        
                        return true;
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚:', error);
                showNotification('âš ï¸ ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'error');
            }
            return false;
        }
        
        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØª ---
        function toggleAppSound() {
            if (soundManager) {
                const enabled = soundManager.toggle();
                updateSoundButton();
                
                const slider = document.getElementById('volume-slider');
                if (enabled) {
                    slider.style.display = 'block';
                    setTimeout(() => slider.style.display = 'none', 3000);
                } else {
                    slider.style.display = 'none';
                }
            }
        }
        
        function updateSoundButton() {
            if (!soundManager) return;
            
            const icon = document.getElementById('sound-icon');
            const enabled = soundManager.enabled;
            
            icon.name = enabled ? 'volume-high' : 'volume-mute';
            document.getElementById('sound-toggle').style.background = 
                enabled ? '#4f46e5' : '#6b7280';
        }
        
        function changeVolume(value) {
            if (soundManager) {
                const volume = value / 100;
                soundManager.setVolume(volume);
                
                if (volume > 0 && soundManager.enabled) {
                    soundManager.play('notification', { volume: volume * 0.5 });
                }
            }
        }
        
        // --- Customer Functions ---
        async function loginCustomer() {
            const phone = document.getElementById('customer-phone').value.trim();
            const password = document.getElementById('customer-password').value;
            
            if (!phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            if (!isValidSudanesePhone(phone)) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø³ÙˆØ¯Ø§Ù†ÙŠ ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            const loginBtn = document.querySelector('#customerLoginForm button');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            loginBtn.disabled = true;
            
            try {
                const { data: customer, error } = await tarhalDB
                    .from('customers')
                    .select('*')
                    .eq('phone', phone)
                    .single();
                
                if (error) {
                    showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„', 'error');
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                    return;
                }
                
                if (customer.password !== password) {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                    return;
                }
                
                if (!customer.is_verified) {
                    showNotification('Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù…ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'warning');
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                    
                    setTimeout(() => {
                        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŸ')) {
                            sendVerificationWhatsApp(customer.phone);
                        }
                    }, 2000);
                    return;
                }
                
                currentUser = customer;
                localStorage.setItem('tarhal_customer', JSON.stringify(customer));
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                showScreen('home-screen');
                updateUserProfile();
                
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        }
        
        async function registerCustomer() {
            const fullname = document.getElementById('register-fullname').value.trim();
            const phone = document.getElementById('register-phone').value.trim();
            const phone2 = document.getElementById('register-phone2').value.trim();
            const password = document.getElementById('register-password').value;
            
            if (!fullname || !phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (!isValidSudanesePhone(phone)) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø³ÙˆØ¯Ø§Ù†ÙŠ ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            const registerBtn = document.querySelector('#customerRegisterForm button');
            const originalText = registerBtn.innerHTML;
            registerBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            registerBtn.disabled = true;
            
            try {
                const { data: existingCustomer, error: checkError } = await tarhalDB
                    .from('customers')
                    .select('id')
                    .eq('phone', phone)
                    .single();
                
                if (existingCustomer) {
                    showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                    registerBtn.innerHTML = originalText;
                    registerBtn.disabled = false;
                    return;
                }
                
                const { data: newCustomer, error } = await tarhalDB
                    .from('customers')
                    .insert([{
                        full_name: fullname,
                        phone: phone,
                        phone2: phone2 || null,
                        password: password,
                        is_verified: false,
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                registeredPhone = phone;
                
                document.getElementById('verification-section').classList.remove('hidden');
                document.getElementById('customerRegisterForm').style.opacity = '0.5';
                registerBtn.disabled = true;
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ù‚Ù… Ø¨ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨', 'success');
                
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message, 'error');
                registerBtn.innerHTML = originalText;
                registerBtn.disabled = false;
            }
        }
        
        function sendVerificationWhatsApp(phone = null) {
            const phoneToVerify = phone || registeredPhone;
            if (!phoneToVerify) return;
            
            const adminNumber = "249918183521";
            const message = "ØªÙØ¹ÙŠÙ„ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§";
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨. Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø³Ø§Ø¨Ùƒ', 'info');
        }
        
        function updateUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('user-avatar').textContent = currentUser.full_name.charAt(0);
            document.getElementById('user-name').textContent = currentUser.full_name;
            document.getElementById('user-phone-display').textContent = currentUser.phone;
            
            if (currentUser.is_verified) {
                document.getElementById('verification-status').classList.remove('hidden');
            }
        }
        
        // --- Driver Functions ---
        async function loginDriver() {
            const phone = document.getElementById('driver-phone').value.trim();
            const password = document.getElementById('driver-password').value;
            
            if (!phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            const loginBtn = document.querySelector('#driverLoginForm button');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            loginBtn.disabled = true;
            
            try {
                const { data: driver, error } = await tarhalDB
                    .from('drivers')
                    .select('*')
                    .eq('whatsapp_number', phone)
                    .eq('is_active', true)
                    .single();
                
                if (error) {
                    showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙØ¹Ù„', 'error');
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                    return;
                }
                
                if (driver.password !== password) {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                    return;
                }
                
                currentDriver = driver;
                localStorage.setItem('tarhal_driver', JSON.stringify(driver));
                
                showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø³Ø§Ø¦Ù‚!', 'success');
                showScreen('driver-dashboard-screen');
                updateDriverDashboard();
                updateDriverUI();
                
            } catch (error) {
                console.error('Driver login error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        }
        
        function contactAdminForDriverRegistration() {
            const adminNumber = "249918183521";
            const message = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒØ³Ø§Ø¦Ù‚ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†";
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'info');
        }
        
        async function updateDriverDashboard() {
            if (!currentDriver) return;
            
            document.getElementById('driver-avatar').textContent = currentDriver.full_name.charAt(0);
            document.getElementById('driver-name').textContent = currentDriver.full_name;
            document.getElementById('driver-car-info').textContent = 
                `${currentDriver.car_model || 'Ø³ÙŠØ§Ø±Ø©'} - ${getVehicleTypeName(currentDriver.car_type)}`;
            
            document.getElementById('driver-balance').textContent = 
                (currentDriver.balance || 0).toLocaleString();
            
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const { data: rides, error } = await tarhalDB
                    .from('rides')
                    .select('*')
                    .eq('driver_id', currentDriver.id)
                    .gte('created_at', today.toISOString())
                    .eq('status', 'completed');
                
                if (!error && rides) {
                    const todayEarnings = rides.reduce((sum, ride) => sum + (ride.driver_earnings || 0), 0);
                    document.getElementById('today-trips').textContent = rides.length;
                    document.getElementById('today-earnings').textContent = todayEarnings.toLocaleString();
                }
                
                const { data: totalRides, error: totalError } = await tarhalDB
                    .from('rides')
                    .select('id')
                    .eq('driver_id', currentDriver.id)
                    .eq('status', 'completed');
                
                if (!totalError && totalRides) {
                    document.getElementById('total-trips').textContent = totalRides.length;
                }
                
            } catch (error) {
                console.error('Error fetching driver stats:', error);
            }
        }
        
        function toggleDriverStatus() {
            isDriverOnline = !isDriverOnline;
            const statusIndicator = document.getElementById('driver-status-indicator');
            const statusText = document.getElementById('driver-status-text');
            const toggleBtn = document.getElementById('toggle-online-btn');
            
            if (isDriverOnline) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø²';
                toggleBtn.innerHTML = '<ion-icon name="power-outline"></ion-icon> Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„';
                toggleBtn.classList.add('btn-danger');
                toggleBtn.classList.remove('btn-driver');
                
                startDriverTracking();
                showNotification('Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±ÙƒÙˆØ¨', 'success');
                
                // ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
                if (Notification.permission === 'default') {
                    setTimeout(() => {
                        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©ØŸ')) {
                            setupDriverNotifications();
                        }
                    }, 1000);
                }
                
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                toggleBtn.innerHTML = '<ion-icon name="power-outline"></ion-icon> ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„';
                toggleBtn.classList.remove('btn-danger');
                toggleBtn.classList.add('btn-driver');
                
                stopDriverTracking();
                showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„', 'info');
            }
        }
        
        function startDriverTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    try {
                        await tarhalDB
                            .from('driver_locations')
                            .upsert({
                                driver_id: currentDriver.id,
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                car_type: currentDriver.car_type,
                                last_seen: new Date().toISOString()
                            }, { onConflict: 'driver_id' });
                        
                        showNotification('Ø¨Ø¯Ø£ ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹Ùƒ...', 'success');
                    } catch (error) {
                        console.error('Tracking error:', error);
                    }
                }, (error) => {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ', 'error');
                });
            }
        }
        
        function stopDriverTracking() {
            console.log('Driver tracking stopped');
        }
        
        // --- Ride Functions ---
        function requestRide() {
            if (!currentUser || !currentUser.is_verified) {
                showNotification('ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø·Ù„Ø¨ Ø±Ø­Ù„Ø©', 'error');
                return;
            }
            
            showScreen('ride-request-screen');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            selectedVehicleType = null;
            destinationPosition = null;
            routeCalculated = false;
            locationMode = 'auto';
            manualModeActive = false;
            manualClickCount = 0;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.querySelectorAll('.vehicle-option').forEach(option => {
                option.classList.remove('selected');
                option.style.borderColor = 'var(--gray-light)';
                option.style.background = 'white';
                option.style.boxShadow = 'none';
            });
            document.getElementById('price-calculation').classList.add('hidden');
            document.getElementById('confirm-ride-btn').disabled = true;
            document.getElementById('route-details-section').classList.add('hidden');
            document.getElementById('destination-clear-btn').classList.add('hidden');
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            const autoBtn = document.getElementById('auto-mode-btn');
            const manualBtn = document.getElementById('manual-mode-btn');
            
            autoBtn.classList.add('active');
            autoBtn.style.background = '#4f46e5';
            autoBtn.style.color = 'white';
            
            manualBtn.classList.remove('active');
            manualBtn.style.background = '#f1f5f9';
            manualBtn.style.color = '#64748b';
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                initRideMap();
            }, 100);
        }
        
        function initRideMap() {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            if (rideMap) {
                rideMap.remove();
                rideMap = null;
            }
            
            startMarker = null;
            endMarker = null;
            routePolyline = null;
            currentRoute = null;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            rideMap = L.map('ride-map', {
                zoomControl: false,
                tap: true
            }).setView([15.5007, 32.5599], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap'
            }).addTo(rideMap);
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)
            locationMode = 'auto';
            manualModeActive = false;
            manualClickCount = 0;
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£ÙˆÙ„Ø§Ù‹
            initAutoLocationMode();
            
            // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ©
            setTimeout(() => {
                if (rideMap) {
                    rideMap.invalidateSize();
                }
            }, 400);
        }
        
        // --- Location Mode Functions ---
        function setLocationMode(mode) {
            locationMode = mode;
            
            const autoBtn = document.getElementById('auto-mode-btn');
            const manualBtn = document.getElementById('manual-mode-btn');
            
            if (mode === 'auto') {
                autoBtn.classList.add('active');
                autoBtn.style.background = '#4f46e5';
                autoBtn.style.color = 'white';
                
                manualBtn.classList.remove('active');
                manualBtn.style.background = '#f1f5f9';
                manualBtn.style.color = '#64748b';
                
                manualModeActive = false;
                manualClickCount = 0;
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø¨Ø¶ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†Ø´Ø·Ø§Ù‹
                if (pulseInterval) {
                    clearInterval(pulseInterval);
                    pulseInterval = null;
                }
                
                if (pulsingMarker) {
                    rideMap.removeLayer(pulsingMarker);
                    pulsingMarker = null;
                }
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                initAutoLocationMode();
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'info');
                
            } else {
                autoBtn.classList.remove('active');
                autoBtn.style.background = '#f1f5f9';
                autoBtn.style.color = '#64748b';
                
                manualBtn.classList.add('active');
                manualBtn.style.background = '#4f46e5';
                manualBtn.style.color = 'white';
                
                manualModeActive = true;
                manualClickCount = 0;
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ
                initManualLocationMode();
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A', 'info');
            }
        }
        
        function initAutoLocationMode() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (rideMap) {
                rideMap.off('click');
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© ÙÙ‚Ø· (Ø§Ù„Ù†Ù‚Ø·Ø© B)
                rideMap.on('click', async (e) => {
                    if (!userPosition) {
                        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                        return;
                    }
                    await setDestination(e.latlng.lat, e.latlng.lng);
                });
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    userPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    if (rideMap) {
                        rideMap.flyTo([userPosition.lat, userPosition.lng], 16);
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (A)
                        if (startMarker) {
                            startMarker.setLatLng([userPosition.lat, userPosition.lng]);
                        } else {
                            startMarker = L.marker([userPosition.lat, userPosition.lng], {
                                icon: L.divIcon({
                                    html: '<div class="start-marker">A</div>',
                                    className: 'start-marker-div',
                                    iconSize: [32, 32],
                                    iconAnchor: [16, 16]
                                })
                            }).addTo(rideMap).bindPopup("Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©").openPopup();
                        }
                        
                        showNotification('âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. Ø§Ù„Ø¢Ù† Ø­Ø¯Ø¯ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„ B', 'success');
                    }
                }, (err) => {
                    showNotification("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ", "warning");
                });
            }
        }
        
        function initManualLocationMode() {
            if (!rideMap) return;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø£Ø­Ø¯Ø§Ø« Ø³Ø§Ø¨Ù‚Ø©
            rideMap.off('click');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯
            manualClickCount = 0;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¹Ù„Ø§Ù…Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
            if (startMarker) {
                rideMap.removeLayer(startMarker);
                startMarker = null;
            }
            
            if (endMarker) {
                rideMap.removeLayer(endMarker);
                endMarker = null;
            }
            
            if (pulsingMarker) {
                rideMap.removeLayer(pulsingMarker);
                pulsingMarker = null;
            }
            
            // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
            showNotification('Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A (Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚)', 'info');
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ
            rideMap.on('click', handleManualMapClick);
        }
        
        function handleManualMapClick(e) {
            if (!manualModeActive) return;
            
            manualClickCount++;
            
            if (manualClickCount === 1) {
                // Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A
                setManualStartPoint(e.latlng.lat, e.latlng.lng);
                
            } else if (manualClickCount === 2) {
                // Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© B
                setManualDestination(e.latlng.lat, e.latlng.lng);
            }
        }
        
        function setManualStartPoint(lat, lng) {
            userPosition = { lat, lng };
            
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù†Ù‚Ø·Ø© A Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶
            if (pulsingMarker) {
                rideMap.removeLayer(pulsingMarker);
            }
            
            startMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    html: '<div class="start-marker">A</div>',
                    className: 'start-marker-div',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                })
            }).addTo(rideMap).bindPopup("Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (ÙŠØ¯ÙˆÙŠ)").openPopup();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¤Ø«Ø± Ø§Ù„Ù†Ø¨Ø¶
            createPulsingEffect(lat, lng);
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            rideMap.flyTo([lat, lng], 16);
            
            // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            showNotification('âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© A ÙŠØ¯ÙˆÙŠØ§Ù‹. Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© B', 'success');
        }
        
        function createPulsingEffect(lat, lng) {
            if (pulseInterval) {
                clearInterval(pulseInterval);
            }
            
            let radius = 10;
            let maxRadius = 30;
            
            pulsingMarker = L.circleMarker([lat, lng], {
                radius: radius,
                color: '#4f46e5',
                fillColor: '#4f46e5',
                fillOpacity: 0.2,
                weight: 2
            }).addTo(rideMap);
            
            pulseInterval = setInterval(() => {
                radius += 2;
                if (radius > maxRadius) {
                    radius = 10;
                }
                
                pulsingMarker.setRadius(radius);
                pulsingMarker.setStyle({
                    fillOpacity: 0.5 - (radius / maxRadius) * 0.5
                });
            }, 200);
        }
        
        function setManualDestination(lat, lng) {
            // Ø¥ÙŠÙ‚Ø§Ù ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶
            if (pulseInterval) {
                clearInterval(pulseInterval);
                pulseInterval = null;
            }
            
            if (pulsingMarker) {
                rideMap.removeLayer(pulsingMarker);
                pulsingMarker = null;
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© B
            setDestination(lat, lng);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            manualClickCount = 0;
            
            // ØªØºÙŠÙŠØ± Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„ÙŠØ­Ø¯Ø¯ ÙÙ‚Ø· Ø§Ù„Ù†Ù‚Ø·Ø© B Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ
            rideMap.off('click');
            rideMap.on('click', async (e) => {
                await setDestination(e.latlng.lat, e.latlng.lng);
            });
        }
        
        async function setDestination(lat, lng) {
            destinationPosition = { lat, lng };
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ù‡Ø©
            document.getElementById('destination-clear-btn').classList.remove('hidden');
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ø§Ù…Ø© Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„ (B)
            if (endMarker) {
                endMarker.setLatLng([lat, lng]);
            } else {
                endMarker = L.marker([lat, lng], {
                    icon: L.divIcon({
                        html: '<div class="end-marker">B</div>',
                        className: 'end-marker-div',
                        iconSize: [32, 32],
                        iconAnchor: [16, 16]
                    })
                }).addTo(rideMap).bindPopup('Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„').openPopup();
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…ÙˆÙ‚Ø¹ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
            if (userPosition) {
                await calculateRealRouteAndDisplay();
            }
            
            if (selectedVehicleType) {
                calculateRidePrice();
            }
        }
        
        async function calculateRealRouteAndDisplay() {
            if (!userPosition || !destinationPosition) return;
            
            // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'location-loading';
            loadingIndicator.innerHTML = `
                <div class="loading"></div>
                <div>Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±...</div>
            `;
            document.getElementById('ride-map').appendChild(loadingIndicator);
            
            try {
                // Ø±Ø§Ø¨Ø· OSRM
                const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${userPosition.lng},${userPosition.lat};${destinationPosition.lng},${destinationPosition.lat}?overview=full&geometries=geojson`;
                
                const response = await fetch(osrmUrl);
                const data = await response.json();
                
                loadingIndicator.remove();
                
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    
                    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±
                    currentRoute = {
                        distance: route.distance / 1000,
                        duration: route.duration / 60,
                        geometry: route.geometry
                    };
                    
                    // Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                    if (route.geometry && route.geometry.coordinates.length > 1) {
                        drawRouteOnMap(route.geometry);
                    }
                    
                    routeCalculated = true;
                    
                    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    showRouteDetails();
                    
                    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚
                    document.getElementById('confirm-ride-btn').disabled = false;
                    
                    showNotification(`âœ“ ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±: ${currentRoute.distance.toFixed(1)} ÙƒÙ…`, 'success');
                    
                    return currentRoute;
                }
            } catch (error) {
                loadingIndicator.remove();
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±:', error);
                showNotification('âš ï¸ ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ù‚ÙŠÙ‚', 'warning');
            }
        }
        
        function drawRouteOnMap(geometry) {
            if (!geometry || !geometry.coordinates || geometry.coordinates.length < 2) return;
            
            if (routePolyline) rideMap.removeLayer(routePolyline);
            
            const coords = geometry.coordinates.map(c => [c[1], c[0]]);
            routePolyline = L.polyline(coords, {
                color: '#4f46e5',
                weight: 5,
                opacity: 0.8,
                lineCap: 'round',
                dashArray: '10, 10',
                className: 'animated-route'
            }).addTo(rideMap);
            
            // ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ Ù„ÙŠØ´Ù…Ù„ Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù„Ø§Ù‹
            const bounds = L.latLngBounds(coords);
            if (startMarker) bounds.extend(startMarker.getLatLng());
            if (endMarker) bounds.extend(endMarker.getLatLng());
            rideMap.fitBounds(bounds, { padding: [50, 50] });
        }
        
        function showRouteDetails() {
            if (!currentRoute) return;
            
            const duration = Math.round(currentRoute.duration);
            const distance = currentRoute.distance;
            const avgSpeed = Math.round((distance / currentRoute.duration) * 60);
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©
            document.getElementById('route-duration').textContent = duration;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø±
            const routeInfoContent = `
                <div class="route-detail-item">
                    <span class="route-detail-label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
                    <span class="route-detail-value">${distance.toFixed(1)} ÙƒÙ…</span>
                </div>
                <div class="route-detail-item">
                    <span class="route-detail-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span>
                    <span class="route-detail-value">${duration} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                </div>
                <div class="route-detail-item">
                    <span class="route-detail-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
                    <span class="route-detail-value">${avgSpeed} ÙƒÙ…/Ø³Ø§Ø¹Ø©</span>
                </div>
                <div class="route-detail-item">
                    <span class="route-detail-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø§Ø±:</span>
                    <span class="route-detail-value">${distance > 10 ? 'Ø·ÙˆÙŠÙ„' : 'Ù‚ØµÙŠØ±'}</span>
                </div>
            `;
            
            document.getElementById('route-info-content').innerHTML = routeInfoContent;
            document.getElementById('route-details-section').classList.remove('hidden');
        }
        
        function clearDestination() {
            if (endMarker) {
                rideMap.removeLayer(endMarker);
                endMarker = null;
            }
            
            if (routePolyline) {
                rideMap.removeLayer(routePolyline);
                routePolyline = null;
            }
            
            destinationPosition = null;
            currentRoute = null;
            routeCalculated = false;
            
            document.getElementById('destination-clear-btn').classList.add('hidden');
            document.getElementById('route-details-section').classList.add('hidden');
            document.getElementById('price-calculation').classList.add('hidden');
            document.getElementById('confirm-ride-btn').disabled = true;
            
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ù‡Ø©', 'info');
        }
        
        function selectVehicle(type) {
            selectedVehicleType = type;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª
            document.querySelectorAll('.vehicle-option').forEach(option => {
                option.classList.remove('selected');
                option.style.borderColor = 'var(--gray-light)';
                option.style.background = 'white';
                option.style.boxShadow = 'none';
            });
            
            // ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±
            const selectedOption = document.querySelector(`.vehicle-option[data-type="${type}"]`);
            selectedOption.classList.add('selected');
            selectedOption.style.borderColor = '#4f46e5';
            selectedOption.style.background = '#eef2ff';
            selectedOption.style.boxShadow = '0 4px 12px rgba(79, 70, 229, 0.15)';
            
            if (destinationPosition && currentRoute) {
                calculateRidePrice();
            }
        }
        
        function calculateRidePrice() {
            if (!userPosition || !destinationPosition || !selectedVehicleType || !currentRoute) return;
            
            const distance = currentRoute.distance;
            const vehicle = VEHICLE_PRICES[selectedVehicleType];
            const additionalKm = Math.max(0, distance - 1);
            const basePrice = vehicle.base;
            const extraPrice = additionalKm * vehicle.perKm;
            const totalPrice = basePrice + extraPrice;
            
            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            document.getElementById('price-calculation').classList.remove('hidden');
            document.getElementById('distance-display').textContent = `${distance.toFixed(1)} km`;
            document.getElementById('base-price-display').textContent = `${basePrice.toLocaleString('en-US')} SDG`;
            document.getElementById('extra-price-display').textContent = `${Math.round(extraPrice).toLocaleString('en-US')} SDG`;
            document.getElementById('total-price-display').textContent = `${Math.round(totalPrice).toLocaleString('en-US')} SDG`;
        }
        
        function formatPrice(amount) {
            // ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø³Ø¹Ø± ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒØ³ÙˆØ±
            const roundedAmount = Math.round(amount);
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù… Ø¨ÙÙˆØ§ØµÙ„ Ø§Ù„Ø¢Ù„Ø§Ù
            return `${roundedAmount.toLocaleString('en-US')} SDG`;
        }
        
        async function confirmRide() {
            if (!selectedVehicleType || !destinationPosition) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'warning');
                return;
            }
            
            if (!currentUser || !currentUser.is_verified) {
                showNotification('ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø·Ù„Ø¨ Ø±Ø­Ù„Ø©', 'error');
                return;
            }
            
            const confirmBtn = document.getElementById('confirm-ride-btn');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...';
            confirmBtn.disabled = true;
            
            showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚ Ù‚Ø±ÙŠØ¨...', 'info');
            
            try {
                const distance = currentRoute ? currentRoute.distance : 0;
                const vehicle = VEHICLE_PRICES[selectedVehicleType];
                const additionalKm = Math.max(0, distance - 1);
                const totalPrice = vehicle.base + (additionalKm * vehicle.perKm);
                
                const { data: ride, error } = await tarhalDB
                    .from('rides')
                    .insert([{
                        customer_id: currentUser.id,
                        customer_name: currentUser.full_name,
                        customer_phone: currentUser.phone,
                        customer_phone2: currentUser.phone2,
                        pickup_lat: userPosition.lat,
                        pickup_lng: userPosition.lng,
                        destination_lat: destinationPosition.lat,
                        destination_lng: destinationPosition.lng,
                        distance_km: parseFloat(distance.toFixed(1)),
                        vehicle_type: selectedVehicleType,
                        amount: totalPrice,
                        status: 'searching',
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                currentRideId = ride.id;
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† (Ù…Ø­Ø§ÙƒØ§Ø©)
                setTimeout(() => {
                    showNotification('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø§Ø¦Ù‚! Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'success');
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
                    if (notificationManager && currentDriver) {
                        notificationManager.sendRideNotificationToDriver(currentDriver.id, {
                            id: ride.id,
                            customerName: currentUser.full_name,
                            customerPhone: currentUser.phone,
                            pickupLocation: 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ… - Ø§Ù„Ø¹Ù…Ø§Ø±Ø§Øª',
                            destination: 'Ø£Ù… Ø¯Ø±Ù…Ø§Ù† - Ø§Ù„Ø³ÙˆÙ‚',
                            distance: `${distance.toFixed(1)} ÙƒÙ…`,
                            price: `${totalPrice.toLocaleString()} SDG`,
                            vehicleType: vehicle.name
                        });
                    }
                    
                    setTimeout(() => {
                        showActiveRideModal(ride);
                    }, 2000);
                    
                }, 3000);
                
            } catch (error) {
                console.error('Ride request error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø±Ø­Ù„Ø©', 'error');
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }
        }
        
        function recenterMap() {
            if (userPosition && rideMap) {
                if (routePolyline && currentRoute) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³Ø§Ø±ØŒ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù„Ø§Ù‹
                    const bounds = routePolyline.getBounds();
                    if (startMarker) bounds.extend(startMarker.getLatLng());
                    if (endMarker) bounds.extend(endMarker.getLatLng());
                    rideMap.fitBounds(bounds, { padding: [50, 50] });
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³Ø§Ø±ØŒ Ø§Ù„ØªÙ…Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙÙ‚Ø·
                    rideMap.setView([userPosition.lat, userPosition.lng], 15);
                }
                
                showNotification('ØªÙ… Ø§Ù„ØªÙ…Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©', 'success');
            }
        }
        
        async function refreshLocation() {
            if (navigator.geolocation) {
                showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                        if (startMarker) {
                            startMarker.setLatLng([userPosition.lat, userPosition.lng]);
                        } else {
                            startMarker = L.marker([userPosition.lat, userPosition.lng], {
                                icon: L.divIcon({
                                    html: '<div class="start-marker">A</div>',
                                    className: 'start-marker-div',
                                    iconSize: [32, 32],
                                    iconAnchor: [16, 16]
                                })
                            }).addTo(rideMap).bindPopup("Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©").openPopup();
                        }
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙˆØ¬Ù‡Ø© Ù…Ø­Ø¯Ø¯Ø©ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±
                        if (destinationPosition) {
                            calculateRealRouteAndDisplay();
                        }
                        
                        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    },
                    (error) => {
                        showNotification('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000
                    }
                );
            }
        }
        
        function showActiveRideModal(ride) {
            const modal = document.getElementById('active-trip-modal');
            modal.classList.remove('hidden');
            
            const tripDetails = document.getElementById('trip-details');
            tripDetails.innerHTML = `
                <div class="card mb-3">
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</span>
                        <span>${VEHICLE_PRICES[ride.vehicle_type].name}</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚:</span>
                        <span>${getNeighborhoodName(ride.pickup_lat, ride.pickup_lng)}</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙˆØµÙˆÙ„:</span>
                        <span>${getNeighborhoodName(ride.destination_lat, ride.destination_lng)}</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø§Ù„Ù…Ø³Ø§ÙØ©:</span>
                        <span>${ride.distance_km} ÙƒÙ…</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø§Ù„Ø³Ø§Ø¦Ù‚:</span>
                        <span>Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-light);">
                        <span>Ø±Ù‚Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:</span>
                        <span>+249 90 123 4567</span>
                    </div>
                    <div class="price-row" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: none; font-weight: 800; color: var(--primary);">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span>${ride.amount.toLocaleString('en-US')} SDG</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <button class="btn btn-secondary" onclick="callDriver()">
                        <ion-icon name="call-outline"></ion-icon>
                        Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚
                    </button>
                </div>
                
                <div class="mb-3">
                    <button class="btn btn-danger" onclick="cancelRide()">
                        <ion-icon name="close-outline"></ion-icon>
                        Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©
                    </button>
                </div>
                
                <p style="text-align: center; color: var(--gray); font-size: 14px;">
                    Ø³ÙŠØªÙ… Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù
                </p>
            `;
            
            document.getElementById('confirm-ride-btn').innerHTML = '<ion-icon name="search-outline"></ion-icon> Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚';
            document.getElementById('confirm-ride-btn').disabled = false;
        }
        
        // --- Helper Functions ---
        function checkAuth() {
            const savedUser = localStorage.getItem('tarhal_customer');
            const savedDriver = localStorage.getItem('tarhal_driver');
            
            if (savedDriver) {
                try {
                    currentDriver = JSON.parse(savedDriver);
                    showScreen('driver-dashboard-screen');
                    updateDriverDashboard();
                    updateDriverUI();
                } catch (e) {
                    localStorage.removeItem('tarhal_driver');
                    showScreen('welcome-screen');
                }
            } else if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showScreen('home-screen');
                    updateUserProfile();
                } catch (e) {
                    localStorage.removeItem('tarhal_customer');
                    showScreen('welcome-screen');
                }
            } else {
                showScreen('welcome-screen');
            }
        }
        
        function getVehicleTypeName(type) {
            const names = {
                tuktuk: 'ØªÙˆÙƒ ØªÙˆÙƒ',
                economy: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©',
                comfort: 'Ù…ØªÙˆØ³Ø·Ø©',
                vip: 'VIP'
            };
            return names[type] || type;
        }
        
        function getNeighborhoodName(lat, lng) {
            return "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…";
        }
        
        function isValidSudanesePhone(phone) {
            const sudanesePhoneRegex = /^(?:\+249|0)?(?:9[0123456789]|1[012])\d{7}$/;
            return sudanesePhoneRegex.test(phone);
        }
        
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notification-area');
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            let icon = 'â„¹ï¸';
            if (type === 'success') icon = 'âœ…';
            else if (type === 'error') icon = 'âŒ';
            else if (type === 'warning') icon = 'âš ï¸';
            
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div style="flex: 1;">${message}</div>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function logout() {
            localStorage.removeItem('tarhal_customer');
            currentUser = null;
            showScreen('welcome-screen');
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function logoutDriver() {
            if (isDriverOnline) {
                toggleDriverStatus();
            }
            localStorage.removeItem('tarhal_driver');
            currentDriver = null;
            showScreen('welcome-screen');
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ø§Ø¦Ù‚', 'success');
        }
        
        // Placeholder functions
        function showMyRides() {
            showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', 'info');
        }
        
        function showWallet() {
            showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', 'info');
        }
        
        function showSettings() {
            showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨', 'info');
        }
        
        function showDriverProfile() {
            showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚', 'info');
        }
        
        function callDriver() {
            showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚...', 'info');
        }
        
        function cancelRide() {
            document.getElementById('active-trip-modal').classList.add('hidden');
            showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'info');
            goHome();
        }
        
        function acceptRide() {
            document.getElementById('incoming-ride-modal').classList.add('hidden');
            showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            showActiveRideModal({
                vehicle_type: 'economy',
                amount: 10000,
                distance_km: 5.2
            });
        }
        
        function declineRide() {
            document.getElementById('incoming-ride-modal').classList.add('hidden');
            showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø±Ø­Ù„Ø©', 'info');
        }
        
        // ØªØ­Ù…ÙŠÙ„ Leaflet Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
        window.addEventListener('load', function() {
            if (typeof L === 'undefined') {
                const leafletScript = document.createElement('script');
                leafletScript.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
                leafletScript.onload = function() {
                    console.log('âœ… Leaflet loaded successfully');
                };
                document.head.appendChild(leafletScript);
            }
            
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            if ('Notification' in window && Notification.permission === 'default') {
                // Ù†Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ ØªÙØ§Ø¹Ù„ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            }
        });
        
        console.log(' ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
    </script>
    
    <!-- Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <script src="notification-manager.js"></script>
    <script src="sound-manager.js"></script>
    
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Tarhal</title>
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    
    <!-- Ø®Ø· Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Ø£Ù†Ù…Ø§Ø· CSS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --primary-light: #818cf8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --driver: #16a34a;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            direction: rtl;
        }
        
        /* Ø­Ø§ÙˆÙŠØ© Ø¹Ø§Ù…Ø© */
        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        .welcome-card {
            background: white;
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            text-align: center;
            animation: fadeInUp 0.6s ease;
        }
        
        .logo-container {
            margin-bottom: 40px;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 48px;
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
        }
        
        h1 {
            color: var(--primary);
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 16px;
            margin-bottom: 10px;
            font-family: 'Tajawal', sans-serif;
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .welcome-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 16px 24px;
            border-radius: 12px;
            border: none;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-large {
            padding: 18px 28px;
            font-size: 18px;
        }
        
        .btn-primary {
            background: var(--primary);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-driver {
            background: var(--driver);
        }
        
        .btn-driver:hover {
            background: #15803d;
        }
        
        .btn-secondary {
            background: var(--secondary);
        }
        
        .btn-secondary:hover {
            background: #6d28d9;
        }
        
        .btn-whatsapp {
            background: #25D366;
        }
        
        .btn-whatsapp:hover {
            background: #128C7E;
        }
        
        .btn-back {
            background: var(--gray-light);
            color: var(--gray);
        }
        
        .btn-back:hover {
            background: #d1d5db;
        }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.4s ease;
        }
        
        .card-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .card-header h2 {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 10px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .card-header p {
            color: var(--gray);
            font-size: 14px;
            font-family: 'Tajawal', sans-serif;
        }
        
        /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .form-group {
            margin-bottom: 20px;
        }
        
        input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-family: 'Tajawal', sans-serif;
            font-size: 16px;
            background: var(--light);
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        /* Ø§Ù„Ù…Ø­Ø¯Ø¯Ø§Øª */
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray);
            font-family: 'Tajawal', sans-serif;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-light);
        }
        
        .divider span {
            padding: 0 15px;
            font-size: 14px;
        }
        
        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ */
        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .success-message p {
            color: var(--success);
            margin-bottom: 5px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .small {
            font-size: 14px;
            color: var(--gray);
        }
        
        .note {
            margin-top: 15px;
            color: var(--gray);
            font-size: 12px;
            text-align: center;
            font-family: 'Tajawal', sans-serif;
        }
        
        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }
        
        .modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.4s ease;
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .modal-header h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .staff-access {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
            font-family: 'Tajawal', sans-serif;
        }
        
        .staff-access small {
            color: var(--gray);
        }
        
        .staff-access a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .staff-access a:hover {
            text-decoration: underline;
        }
        
        /* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 99999;
            animation: slideInRight 0.5s ease;
            border-right: 5px solid var(--primary);
            max-width: 300px;
            font-family: 'Tajawal', sans-serif;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ÙŠØ© */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .welcome-card {
                padding: 30px 20px;
            }
            
            .logo {
                width: 80px;
                height: 80px;
                font-size: 40px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 15px;
            }
            
            .btn-large {
                padding: 16px 24px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .card {
                padding: 20px 15px;
            }
            
            input {
                padding: 14px 16px;
                font-size: 15px;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
        @media (max-width: 320px) {
            .container {
                padding: 10px;
            }
            
            .welcome-card {
                padding: 20px 15px;
            }
            
            .logo {
                width: 70px;
                height: 70px;
                font-size: 35px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© */
        html, body {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù„Ù…Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        button, input, .btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
    <div id="welcome-screen" class="container">
        <div class="welcome-card">
            <div class="logo-container">
                <div class="logo">ğŸš–</div>
                <h1>ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</h1>
                <p class="tagline">Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù…Ù†Ø© Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ</p>
            </div>
            
            <div class="welcome-buttons">
                <button class="btn btn-primary btn-large" onclick="showSection('customer-login')">
                    <span>ğŸ‘¤ Ø¯Ø®ÙˆÙ„ Ø·Ø§Ù„Ø¨ Ø±Ø­Ù„Ø©</span>
                </button>
                
                <button class="btn btn-driver btn-large" onclick="showSection('driver-login')">
                    <span>ğŸš— Ø¯Ø®ÙˆÙ„ Ø³Ø§Ø¦Ù‚</span>
                </button>
            </div>
            
            <div class="staff-access">
                <small>Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: <a href="#" onclick="showStaffAccess()">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</a></small>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø²Ø¨ÙˆÙ† -->
    <div id="customer-login" class="container hidden">
        <div class="card">
            <div class="card-header">
                <h2>ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø·Ø§Ù„Ø¨ Ø±Ø­Ù„Ø©</h2>
                <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
            </div>
            
            <div class="form-group">
                <input type="tel" id="customer-login-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" required>
            </div>
            
            <div class="form-group">
                <input type="password" id="customer-login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
            </div>
            
            <button class="btn btn-primary" onclick="loginCustomer()">
                <span>ğŸš€ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </button>
            
            <div class="divider">
                <span>Ø£Ùˆ</span>
            </div>
            
            <button class="btn btn-secondary" onclick="showSection('customer-register')">
                <span>ğŸ“ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†</span>
            </button>
            
            <button class="btn btn-back" onclick="showSection('welcome-screen')">
                <span>â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</span>
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø²Ø¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯ -->
    <div id="customer-register" class="container hidden">
        <div class="card">
            <div class="card-header">
                <h2>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <p>Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</p>
            </div>
            
            <div id="registration-form">
                <div class="form-group">
                    <input type="text" id="fullname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ" required>
                </div>
                
                <div class="form-group">
                    <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" required>
                </div>
                
                <div class="form-group">
                    <input type="tel" id="phone2" placeholder="Ø±Ù‚Ù… Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                
                <div class="form-group">
                    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>
                
                <button class="btn btn-primary" id="btn-register" onclick="handleRegister()">
                    <span>âœ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                </button>
            </div>
            
            <div id="verification-section" class="hidden" style="margin-top: 20px;">
                <div class="success-message">
                    <p>âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!</p>
                    <p class="small">Ø§Ø¶ØºØ· Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù„ØªÙØ¹ÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</p>
                </div>
                <button class="btn btn-whatsapp" id="btn-verify" onclick="sendWhatsAppMessage()">
                    <span>ğŸ’¬ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨</span>
                </button>
                
                <div class="note">
                    <small>Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚</small>
                </div>
            </div>
            
            <button class="btn btn-back" onclick="showSection('customer-login')">
                <span>â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø³Ø§Ø¦Ù‚ -->
    <div id="driver-login" class="container hidden">
        <div class="card">
            <div class="card-header">
                <h2>ğŸš— ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚</h2>
                <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
            </div>
            
            <div class="form-group">
                <input type="tel" id="driver-login-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" required>
            </div>
            
            <div class="form-group">
                <input type="password" id="driver-login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
            </div>
            
            <button class="btn btn-driver" onclick="loginDriver()">
                <span>ğŸš— Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚</span>
            </button>
            
            <div class="divider">
                <span>Ø£Ùˆ</span>
            </div>
            
            <button class="btn btn-secondary" onclick="openDriverRegistrationWhatsApp()">
                <span>ğŸ“‹ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¦Ù‚ØŸ Ø³Ø¬Ù„ ÙƒØ³Ø§Ø¦Ù‚ Ø§Ù„Ø¢Ù†</span>
            </button>
            
            <button class="btn btn-back" onclick="showSection('welcome-screen')">
                <span>â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</span>
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
    <div id="staff-passcode-modal" class="overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>ğŸ”’ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <p>Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
            </div>
            
            <div class="form-group">
                <input type="password" id="staff-passcode" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="off">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="verifyStaffPasscode()">
                    <span>âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                </button>
                <button class="btn btn-back" onclick="closeStaffPasscodeModal()">
                    <span>â†©ï¸ Ø¥Ù„ØºØ§Ø¡</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notification-area"></div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase
        const SB_URL = 'https://zsmlyiygjagmhnglrhoa.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzbWx5aXlnamFnbWhuZ2xyaG9hIiwicm9sZURI6ImFub24iLCJpYXQiOjE3NjU5NDc3NjMsImV4cCI6MjA4MTUyMzc2M30.QviVinAng-ILq0umvI5UZCFEvNpP3nI0kW_hSaXxNps';
        const sb = window.supabase.createClient(SB_URL, SB_KEY);
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentUser = null;
        let currentDriver = null;
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
            initApp();
            registerServiceWorker();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
            window.addEventListener('error', function(e) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£:', e.error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            });
        });
        
        async function initApp() {
            console.log('Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
            const savedUser = localStorage.getItem('tarhal_customer');
            const savedDriver = localStorage.getItem('tarhal_driver');
            
            if (savedDriver) {
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø§Ø¦Ù‚ Ù…Ø­ÙÙˆØ¸');
                // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
                window.location.href = 'driver-dashboard.html';
            } else if (savedUser) {
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø¨ÙˆÙ† Ù…Ø­ÙÙˆØ¸');
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø²Ø¨ÙˆÙ†
                window.location.href = 'home.html';
            } else {
                console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨');
                // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
                showSection('welcome-screen');
            }
        }
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ - ØªÙ… ØªØµØ­ÙŠØ­Ù‡Ø§
        function showSection(sectionId) {
            console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…:', sectionId);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
            const containers = document.querySelectorAll('.container');
            containers.forEach(c => {
                c.classList.add('hidden');
                console.log('Ø¥Ø®ÙØ§Ø¡:', c.id);
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ overlays
            const overlays = document.querySelectorAll('.overlay');
            overlays.forEach(o => o.classList.add('hidden'));
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('ØªÙ… Ø¥Ø¸Ù‡Ø§Ø±:', sectionId);
            } else {
                console.error('Ø§Ù„Ù‚Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯:', sectionId);
            }
        }
        
        // Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function showStaffAccess() {
            console.log('ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            document.getElementById('staff-passcode-modal').classList.remove('hidden');
        }
        
        function closeStaffPasscodeModal() {
            document.getElementById('staff-passcode-modal').classList.add('hidden');
            document.getElementById('staff-passcode').value = '';
        }
        
        async function verifyStaffPasscode() {
            const passcode = document.getElementById('staff-passcode').value;
            console.log('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±...');
            
            if (!passcode) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            try {
                const { data: settings, error } = await sb
                    .from('system_settings')
                    .select('value')
                    .eq('key', 'staff_passcode')
                    .single();
                
                if (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:', error);
                    // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    const defaultPasscode = '123456';
                    if (passcode === defaultPasscode) {
                        window.location.href = 'admin-panel.html';
                    } else {
                        showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    }
                    return;
                }
                
                if (settings && settings.value === passcode) {
                    console.log('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØµØ­ÙŠØ­Ø©ØŒ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
                    // ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    window.location.href = 'admin-panel.html';
                } else {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            } catch (error) {
                console.error('Error verifying passcode:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚', 'error');
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        function openDriverRegistrationWhatsApp() {
            const adminNumber = "249XXXXXXXXX"; // Ø¶Ø¹ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‡Ù†Ø§
            const message = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒØ³Ø§Ø¦Ù‚ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø­Ø§Ù„";
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            console.log('ÙØªØ­ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ³Ø¬ÙŠÙ„:', whatsappUrl);
            window.open(whatsappUrl, '_blank');
        }
        
        // --- Ø¯ÙˆØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ---
        
        async function loginCustomer() {
            console.log('Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ†...');
            const phone = document.getElementById('customer-login-phone').value.trim();
            const password = document.getElementById('customer-login-password').value;
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:', { phone: phone.substring(0, 3) + '***', password: password ? '****' : 'ÙØ§Ø±Øº' });
            
            if (!phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            try {
                const { data: customer, error } = await sb
                    .from('customers')
                    .select('*')
                    .eq('phone', phone)
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„', 'error');
                    } else {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†:', error);
                        throw error;
                    }
                    return;
                }
                
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø¨ÙˆÙ†:', customer.full_name);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                if (!customer.is_verified) {
                    showNotification('Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ£ÙƒÙŠØ¯ Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ø¨Ø± Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©', 'error');
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                if (customer.password !== password) {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    return;
                }
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                currentUser = customer;
                localStorage.setItem('tarhal_customer', JSON.stringify(customer));
                console.log('ØªÙ… Ø­ÙØ¸ Ø¬Ù„Ø³Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†');
                showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ' + customer.full_name, 'success');
                
                // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 1500);
                
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
            }
        }
        
        async function handleRegister() {
            console.log('Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø²Ø¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯...');
            const fullname = document.getElementById('fullname').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const phone2 = document.getElementById('phone2').value.trim();
            const password = document.getElementById('password').value;
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', { 
                fullname: fullname, 
                phone: phone.substring(0, 3) + '***', 
                phone2: phone2.substring(0, 3) + '***',
                password: password ? '****' : 'ÙØ§Ø±Øº' 
            });
            
            if (!fullname || !phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ØŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
            if (phone.length < 10) {
                showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØµØ­ÙŠØ­Ø§Ù‹', 'error');
                return;
            }
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                const { data: existingCustomer, error: checkError } = await sb
                    .from('customers')
                    .select('id')
                    .eq('phone', phone)
                    .single();
                
                if (existingCustomer) {
                    showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„!', 'error');
                    return;
                }
                
                console.log('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { data, error } = await sb
                    .from('customers')
                    .insert([{
                        full_name: fullname,
                        phone: phone,
                        phone2: phone2 || null,
                        password: password,
                        is_verified: false,
                        created_at: new Date()
                    }])
                    .select();
                
                if (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    throw error;
                }
                
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:', data);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                document.getElementById('registration-form').style.opacity = "0.5";
                document.getElementById('btn-register').disabled = true;
                document.getElementById('verification-section').classList.remove('hidden');
                
                // Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
                localStorage.setItem('pending_verification_phone', phone);
                
                showNotification('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + (error.message || 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©'), 'error');
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ£ÙƒÙŠØ¯
        function sendWhatsAppMessage() {
            const phone = document.getElementById('phone').value;
            const savedPhone = localStorage.getItem('pending_verification_phone');
            const adminNumber = "249XXXXXXXXX"; // Ø¶Ø¹ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‡Ù†Ø§
            const message = "ØªÙØ¹ÙŠÙ„ ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§";
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            const phoneToUse = savedPhone || phone;
            
            if (!phoneToUse) {
                showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨', 'error');
                return;
            }
            
            console.log('Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙØ¹ÙŠÙ„:', phoneToUse);
            
            // Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
            showNotification('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'info');
            
            // Ø­Ø°Ù Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸
            localStorage.removeItem('pending_verification_phone');
        }
        
        async function loginDriver() {
            console.log('Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚...');
            const phone = document.getElementById('driver-login-phone').value.trim();
            const password = document.getElementById('driver-login-password').value;
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚:', { 
                phone: phone.substring(0, 3) + '***', 
                password: password ? '****' : 'ÙØ§Ø±Øº' 
            });
            
            if (!phone || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            try {
                const { data: driver, error } = await sb
                    .from('drivers')
                    .select('*')
                    .eq('whatsapp_number', phone)
                    .eq('is_active', true)
                    .single();
                
                if (error || !driver) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚:', error);
                    showNotification('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙØ¹Ù„', 'error');
                    return;
                }
                
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø§Ø¦Ù‚:', driver.full_name);
                
                if (driver.password !== password) {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    return;
                }
                
                currentDriver = driver;
                localStorage.setItem('tarhal_driver', JSON.stringify(driver));
                console.log('ØªÙ… Ø­ÙØ¸ Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚');
                showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ' + driver.full_name, 'success');
                
                setTimeout(() => {
                    window.location.href = 'driver-dashboard.html';
                }, 1500);
                
            } catch (error) {
                console.error('Driver login error:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            }
        }
        
        // --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        
        function showNotification(message, type = 'info') {
            console.log('Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±:', type, message);
            const notificationArea = document.getElementById('notification-area');
            
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            const titles = {
                success: 'Ù†Ø¬Ø§Ø­',
                error: 'Ø®Ø·Ø£',
                warning: 'ØªØ­Ø°ÙŠØ±',
                info: 'Ù…Ø¹Ù„ÙˆÙ…Ø©'
            };
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderRightColor = colors[type] || colors.info;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 24px;">
                        ${icons[type] || icons.info}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; margin-bottom: 5px; color: #1f2937;">
                            ${titles[type] || titles.info}
                        </div>
                        <div style="color: #4b5563; font-size: 14px;">${message}</div>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
            notificationArea.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideInRight 0.5s ease reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 500);
                }
            }, 3000);
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(registration => {
                            console.log('Service Worker registered successfully:', registration.scope);
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                console.log('Service Worker update found:', newWorker.state);
                                
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        console.log('New service worker installed, showing update prompt');
                                        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ§Ø­
                                        if (confirm('ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­. Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
                                            newWorker.postMessage({ type: 'SKIP_WAITING' });
                                            window.location.reload();
                                        }
                                    }
                                });
                            });
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            } else {
                console.log('Service Worker not supported');
            }
        }
        
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    console.log('Notification permission:', permission);
                });
            }
        }
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        requestNotificationPermission();
        
        // ØªØµØ­ÙŠØ­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø¥Ø¶Ø§ÙØ© ØªØ­Ù…ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ)
        window.addEventListener('load', function() {
            console.log('ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† display Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ÙÙŠØ©
            const hiddenElements = document.querySelectorAll('.hidden');
            hiddenElements.forEach(el => {
                if (el.style.display !== 'none') {
                    el.style.display = 'none';
                }
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù‚Ø³Ù… Ø¸Ø§Ù‡Ø±
            const visibleSections = Array.from(document.querySelectorAll('.container')).filter(
                el => !el.classList.contains('hidden')
            );
            
            if (visibleSections.length === 0) {
                console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ø¸Ø§Ù‡Ø±Ø©ØŒ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨');
                showSection('welcome-screen');
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
            });
        });
        
        // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        setTimeout(() => {
            console.log('ÙØ­Øµ Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            const buttons = document.querySelectorAll('button');
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±:', buttons.length);
            buttons.forEach((btn, index) => {
                console.log(`Ø²Ø± ${index}:`, {
                    text: btn.textContent,
                    display: getComputedStyle(btn).display,
                    visibility: getComputedStyle(btn).visibility
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Tajawal Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙØªÙ‚Ø¯Ù‡
            const textElements = document.querySelectorAll('h1, h2, h3, p, span, button, input, label');
            textElements.forEach(el => {
                if (!el.style.fontFamily.includes('Tajawal')) {
                    el.style.fontFamily = "'Tajawal', sans-serif";
                }
            });
        }, 500);
        
        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        console.log('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
    </script>
</body>
</html>
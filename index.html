<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Tarhal Sudan</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192">

    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f4f6;
            text-align: center;
        }
        header {
            background-color: #4f46e5;
            color: white;
            padding: 20px;
            font-size: 24px;
            font-bold: true;
        }
        .container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            margin-top: 50px;
        }
        button {
            width: 80%;
            max-width: 300px;
            padding: 15px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
        }
        .btn-customer { background-color: #2563eb; color: white; }
        .btn-driver { background-color: #16a34a; color: white; }
        
        #map {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            display: none; /* ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© */
            border-radius: 15px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <header>ØªØ±Ø­Ø§Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† ğŸ‡¸ğŸ‡©</header>

    <div id="main-menu" class="container">
        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ±Ø­Ø§Ù„</h2>
        <p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        
        <button class="btn-customer" onclick="showRegistration('customer')">ØªØ³Ø¬ÙŠÙ„ ÙƒØ²Ø¨ÙˆÙ†</button>
        <button class="btn-driver" onclick="showRegistration('driver')">ØªØ³Ø¬ÙŠÙ„ ÙƒØ³Ø§Ø¦Ù‚</button>
    </div>

    <div id="registration-form" class="container hidden">
        <h3 id="form-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
        <input type="text" id="full-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ" style="width: 80%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" style="width: 80%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; margin-top: 10px;">
        <button id="submit-btn" class="btn-customer" style="margin-top: 15px;">Ø¥Ø±Ø³Ø§Ù„</button>
        <button onclick="goBack()" style="background: none; color: #666; font-size: 14px;">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="map"></div>

    <script>
        // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Offline
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­'))
                    .catch(err => console.log('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker', err));
            });
        }

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase (Ø¶Ø¹ Ù…ÙØ§ØªÙŠØ­Ùƒ Ù‡Ù†Ø§)
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
        function showRegistration(type) {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('registration-form').classList.remove('hidden');
            
            if (type === 'driver') {
                document.getElementById('form-title').innerText = 'ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚';
                document.getElementById('submit-btn').innerText = 'ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                document.getElementById('submit-btn').onclick = () => {
                    window.open('https://wa.me/2499XXXXXXXX', '_blank'); // Ø±Ù‚Ù… ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                };
            } else {
                document.getElementById('form-title').innerText = 'ØªØ³Ø¬ÙŠÙ„ Ø²Ø¨ÙˆÙ†';
                document.getElementById('submit-btn').innerText = 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…';
                document.getElementById('submit-btn').onclick = handleCustomerSignup;
            }
        }

        function goBack() {
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('registration-form').classList.add('hidden');
        }

        async function handleCustomerSignup() {
            const name = document.getElementById('full-name').value;
            const phone = document.getElementById('phone').value;
            
            if(!name || !phone) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                return;
            }

            // Ù‡Ù†Ø§ ØªØ¶Ø¹ Ù…Ù†Ø·Ù‚ Supabase Auth Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ " + phone);
        }

        // 4. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© (MapLibre)
        function initMap(lat, lng) {
            document.getElementById('map').style.display = 'block';
            const map = new maplibregl.Map({
                container: 'map',
                style: 'https://demotiles.maplibre.org/style.json', // Ù†Ù…Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                center: [lng, lat],
                zoom: 14
            });

            new maplibregl.Marker().setLngLat([lng, lat]).addTo(map);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø© - ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§</title>
    
    <!-- âœ… Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #e0e7ff;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --danger: #ef4444;
            --warning: #f59e0b;
            --light: #f9fafb;
            --dark: #111827;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --radius: 12px;
            --radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .app-container {
            max-width: 420px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        
        /* âœ… Header Ù…Ø®ØªØµØ± */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        
        .header-text {
            flex: 1;
            text-align: right;
        }
        
        .app-header h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .app-header p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .urgent-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* âœ… Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */
        .page-content {
            padding: 20px;
        }
        
        /* âœ… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ù…Ø¯Ù…Ø¬ */
        .countdown-section {
            background: linear-gradient(135deg, #fef2f2, #fef3c7);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid var(--warning);
        }
        
        .countdown-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .countdown-label {
            font-size: 14px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .countdown-timer {
            font-size: 32px;
            font-weight: 900;
            color: var(--danger);
            font-family: 'Tajawal', monospace;
        }
        
        .countdown-progress {
            height: 6px;
            background: rgba(239, 68, 68, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .countdown-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning));
            width: 100%;
            animation: countdownShrink 45s linear forwards;
        }
        
        @keyframes countdownShrink {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        /* âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
        .ride-summary {
            background: var(--light);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--gray-light);
        }
        
        .ride-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .ride-icon {
            font-size: 24px;
            color: var(--primary);
        }
        
        .ride-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* âœ… Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .detail-item {
            background: white;
            border-radius: var(--radius);
            padding: 12px;
            border: 1px solid var(--gray-light);
        }
        
        .detail-label {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .detail-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            line-height: 1.4;
        }
        
        .detail-price {
            background: linear-gradient(135deg, #e0e7ff, #ede9fe);
            border-color: var(--primary-light);
        }
        
        /* âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø± */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        
        .btn {
            padding: 14px;
            border-radius: var(--radius);
            border: none;
            font-family: 'Tajawal', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        /* âœ… Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© */
        .secondary-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
            font-size: 13px;
            padding: 10px;
        }
        
        .btn-secondary:hover {
            background: var(--primary-light);
        }
        
        /* âœ… Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        /* âœ… ØªØ­ÙƒÙ… Ø§Ù„ØµÙˆØª */
        .sound-control {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .sound-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        .volume-slider {
            background: white;
            padding: 12px;
            border-radius: 25px;
            box-shadow: var(--shadow-lg);
            width: 50px;
            display: none;
        }
        
        .volume-slider input {
            width: 100%;
            direction: ltr;
            transform: rotate(-90deg);
        }
        
        /* âœ… Responsive */
        @media (max-width: 380px) {
            .page-content {
                padding: 16px;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .secondary-actions {
                grid-template-columns: 1fr;
            }
        }
        
        /* âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: white;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: notificationSlide 0.3s ease;
            border-right: 3px solid var(--primary);
            max-width: 400px;
            margin: 0 auto;
        }
        
        @keyframes notificationSlide {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
<!-- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø¯Ø§Ø®Ù„ <body> ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© -->
<div id="audio-enabler" style="
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 99999;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Tajawal';
">
    <div style="
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 400px;
        width: 90%;
        text-align: center;
    ">
        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ”Š</div>
        <h3 style="color: #4f46e5; margin-bottom: 15px;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª</h3>
        <p style="color: #666; margin-bottom: 25px;">
            Ù„ØªÙ„Ù‚ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŒ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¢Ù†.
        </p>
        <button onclick="enableAudioSystem()" style="
            background: #4f46e5;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        ">
            ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¢Ù†
        </button>
    </div>
</div>

<script>
function enableAudioSystem() {
    // 1. Ø¥Ø²Ø§Ù„Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
    document.getElementById('audio-enabler').remove();
    
    // 2. ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
    const testSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3');
    testSound.volume = 0.3;
    
    testSound.play().then(() => {
        // 3. ØªØ®Ø²ÙŠÙ† Ø£Ù† Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„
        localStorage.setItem('audio_enabled', 'true');
        
        // 4. Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
        showNotification('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        
        // 5. ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø­Ù„Ø©
        if (window.soundManager) {
            window.soundManager.enabled = true;
            window.soundManager.play('new_ride');
        }
        
    }).catch(error => {
        showNotification('âš ï¸ ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­', 'error');
    });
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„Ø§Ù‹ Ù…Ø³Ø¨Ù‚Ø§Ù‹
if (localStorage.getItem('audio_enabled') === 'true') {
    document.getElementById('audio-enabler').style.display = 'none';
}
</script>
    <!-- âœ… ØªØ­ÙƒÙ… Ø§Ù„ØµÙˆØª -->
    <div class="sound-control">
        <div class="sound-toggle" id="sound-toggle" onclick="toggleSound()">
            <ion-icon name="volume-high-outline" id="sound-icon" style="font-size: 24px; color: white;"></ion-icon>
        </div>
        <div class="volume-slider" id="volume-slider">
            <input type="range" min="0" max="100" value="70" 
                   oninput="changeVolume(this.value)">
        </div>
    </div>
    
    <div class="app-container">
        <!-- âœ… Header Ù…Ø®ØªØµØ± -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>ğŸš– Ø·Ù„Ø¨ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯</h1>
                    <p>ØªØ±Ø­Ø§Ù„ Ø²ÙˆÙ†Ø§ - Ù‚Ø¨ÙˆÙ„ Ø³Ø±ÙŠØ¹</p>
                </div>
                <div>
                    <span class="urgent-badge">
                        <ion-icon name="flash"></ion-icon>
                        Ø¹Ø§Ø¬Ù„
                    </span>
                </div>
            </div>
        </header>
        
        <!-- âœ… Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
        <div class="page-content">
            <!-- âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø© -->
            <div class="status-indicator status-pending" id="status-indicator">
                <ion-icon name="time-outline"></ion-icon>
                <span id="status-text">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯Ùƒ - 45 Ø«Ø§Ù†ÙŠØ©</span>
            </div>
            
            <!-- âœ… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ù…Ø¯Ù…Ø¬ -->
            <div class="countdown-section">
                <div class="countdown-info">
                    <div class="countdown-label">
                        <ion-icon name="timer-outline"></ion-icon>
                        Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                    </div>
                    <div class="countdown-timer" id="countdown-timer">45</div>
                </div>
                <div class="countdown-progress">
                    <div class="countdown-bar"></div>
                </div>
            </div>
            
            <!-- âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© -->
            <div class="ride-summary">
                <div class="ride-header">
                    <ion-icon name="information-circle-outline" class="ride-icon"></ion-icon>
                    <div class="ride-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©</div>
                </div>
                
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="person-outline"></ion-icon>
                            Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </div>
                        <div class="detail-value" id="customer-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="call-outline"></ion-icon>
                            Ø§Ù„Ù‡Ø§ØªÙ
                        </div>
                        <div class="detail-value" id="customer-phone">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="car-outline"></ion-icon>
                            Ø§Ù„Ù†ÙˆØ¹
                        </div>
                        <div class="detail-value" id="vehicle-type">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="navigate-outline"></ion-icon>
                            Ø§Ù„Ù…Ø³Ø§ÙØ©
                        </div>
                        <div class="detail-value" id="distance">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="location-outline"></ion-icon>
                            Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚
                        </div>
                        <div class="detail-value" id="pickup-location">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <ion-icon name="pin-outline"></ion-icon>
                            Ø§Ù„ÙˆØµÙˆÙ„
                        </div>
                        <div class="detail-value" id="destination">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <div class="detail-item detail-price" style="grid-column: span 2;">
                        <div class="detail-label">
                            <ion-icon name="cash-outline"></ion-icon>
                            Ø§Ù„Ø³Ø¹Ø±
                        </div>
                        <div class="detail-value" id="price" style="color: var(--primary); font-size: 16px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>
            
            <!-- âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="acceptRide()" id="accept-btn">
                    <ion-icon name="checkmark-circle-outline"></ion-icon>
                    Ù‚Ø¨ÙˆÙ„
                </button>
                
                <button class="btn btn-danger" onclick="declineRide()" id="decline-btn">
                    <ion-icon name="close-circle-outline"></ion-icon>
                    Ø±ÙØ¶
                </button>
            </div>
            
            <!-- âœ… Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© -->
            <div class="secondary-actions">
                <button class="btn btn-secondary" onclick="callCustomer()">
                    <ion-icon name="call-outline"></ion-icon>
                    Ø§ØªØµØ§Ù„ Ø³Ø±ÙŠØ¹
                </button>
                
                <button class="btn btn-secondary" onclick="viewMap()">
                    <ion-icon name="map-outline"></ion-icon>
                    Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                </button>
            </div>
            
            <!-- âœ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
            <div style="text-align: center; margin-top: 20px;">
                <div style="font-size: 12px; color: var(--gray);">
                    <ion-icon name="information-circle-outline" style="font-size: 14px;"></ion-icon>
                    ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <span id="response-time" style="font-weight: 600;">0</span> Ø«Ø§Ù†ÙŠØ©
                </div>
            </div>
            
            <!-- âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© -->
            <div id="response-message" style="margin-top: 16px;"></div>
            
            <!-- âœ… Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
            <button class="btn btn-secondary" onclick="goBack()" style="width: 100%; margin-top: 16px;">
                <ion-icon name="arrow-back-outline"></ion-icon>
                Ø§Ù„Ø¹ÙˆØ¯Ø©
            </button>
        </div>
    </div>
    
    <script>
        // ==============================================
        // âœ… Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø¯Ø§Ø¦Ù… Ù„ØªØ±Ø­Ø§Ù„
        // ==============================================
        class TarhalSoundManager {
            constructor() {
                this.initialized = false;
                this.enabled = true;
                this.volume = 0.7;
                this.sounds = new Map();
                
                // Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙˆØ§Øª
                 TarhalSoundManager
this.soundLibrary = {
    'new_ride': 'https://assets.mixkit.co/sfx/download/mixkit-retro-game-emergency-alarm-1000.mp3',
    'ride_accepted': 'https://assets.mixkit.co/sfx/download/mixkit-winning-chimes-2015.mp3', 
    'ride_declined': 'https://assets.mixkit.co/sfx/download/mixkit-wrong-answer-fail-notification-946.mp3',
    'notification': 'https://assets.mixkit.co/sfx/download/mixkit-message-pop-up-alert-2354.mp3',
    'time_warning': 'https://assets.mixkit.co/sfx/download/mixkit-fast-small-sweep-transition-166.mp3',
    'beep': 'https://assets.mixkit.co/sfx/download/mixkit-alarm-digital-clock-beep-989.mp3'
};
                
                this.init();
            }
            
            async init() {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† localStorage
                this.loadPreferences();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                await this.attemptAutoEnable();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹
                await this.preloadSounds();
                
                this.initialized = true;
                console.log('ğŸ”Š Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø¯Ø§Ø¦Ù… Ø¬Ø§Ù‡Ø²');
            }
            
            loadPreferences() {
                try {
                    const saved = localStorage.getItem('tarhal_sound_prefs');
                    if (saved) {
                        const prefs = JSON.parse(saved);
                        this.enabled = prefs.enabled !== false;
                        this.volume = prefs.volume || 0.7;
                    }
                } catch (e) {
                    console.log('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª');
                }
            }
            
            savePreferences() {
                const prefs = {
                    enabled: this.enabled,
                    volume: this.volume,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('tarhal_sound_prefs', JSON.stringify(prefs));
            }
            
            async attemptAutoEnable() {
                if (!this.enabled) return false;
                
                try {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø°ÙƒÙŠØ© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
                    const audio = new Audio();
                    audio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==';
                    audio.volume = 0.001;
                    
                    await audio.play();
                    audio.pause();
                    
                    return true;
                } catch (error) {
                    console.log('ğŸ”‡ ÙŠØ­ØªØ§Ø¬ ØªÙØ¹ÙŠÙ„ ÙŠØ¯ÙˆÙŠ');
                    this.showEnablePrompt();
                    return false;
                }
            }
            
            async preloadSounds() {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                for (const [name, url] of Object.entries(this.soundLibrary)) {
                    try {
                        const audio = new Audio();
                        audio.src = url;
                        audio.volume = 0;
                        this.sounds.set(name, audio);
                    } catch (error) {
                        console.log(`âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª ${name}`);
                    }
                }
            }
            
            async play(soundName, options = {}) {
                if (!this.enabled || !this.initialized) {
                    if (!this.enabled && this.initialized) {
                        this.showEnablePrompt();
                    }
                    return false;
                }
                
                const config = {
                    volume: options.volume || this.volume,
                    loop: options.loop || false,
                    ...options
                };
                
                try {
                    const url = this.soundLibrary[soundName];
                    if (!url) return false;
                    
                    const audio = new Audio(url);
                    audio.volume = config.volume;
                    audio.loop = config.loop;
                    
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        await playPromise;
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.log('âŒ ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', error.name);
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ø¨Ø³Ø¨Ø¨ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© ØªÙØ¹ÙŠÙ„
                    if (error.name === 'NotAllowedError') {
                        this.showEnablePrompt();
                    }
                    
                    return false;
                }
            }
            
            showEnablePrompt() {
                // Ù…Ù†Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªÙƒØ±Ø±
                if (document.getElementById('tarhal-sound-prompt')) return;
                
                const prompt = document.createElement('div');
                prompt.id = 'tarhal-sound-prompt';
                prompt.style.cssText = `
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8);
                    z-index: 99999;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-family: 'Tajawal', sans-serif;
                    animation: fadeIn 0.3s ease;
                `;
                
                prompt.innerHTML = `
                    <div style="background: white; border-radius: 20px; padding: 30px; max-width: 400px; width: 90%; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ”Š</div>
                        <h3 style="color: #4f46e5; margin-bottom: 15px; font-weight: 700;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª</h3>
                        <p style="color: #6b7280; margin-bottom: 25px; line-height: 1.6;">
                            ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ù„Ø³Ù…Ø§Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ÙˆÙ‚Øª.
                            Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="window.soundManager.enableSounds()" 
                                    style="background: #4f46e5; color: white; border: none; 
                                           padding: 15px 30px; border-radius: 12px; 
                                           font-size: 16px; font-weight: bold; cursor: pointer;
                                           flex: 1;">
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
                            </button>
                            <button onclick="document.getElementById('tarhal-sound-prompt').remove()" 
                                    style="background: transparent; color: #6b7280; border: 1px solid #e5e7eb;
                                           padding: 15px 20px; border-radius: 12px; cursor: pointer;">
                                ØªØ®Ø·ÙŠ Ø§Ù„Ø¢Ù†
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(prompt);
                
                // Ø¥Ø²Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ 20 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    if (prompt.parentNode) {
                        prompt.remove();
                    }
                }, 20000);
            }
            
            async enableSounds() {
                try {
                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ø®ØªØ¨Ø§Ø±
                    await this.play('beep', { volume: 0.3 });
                    
                    this.enabled = true;
                    this.savePreferences();
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                    const prompt = document.getElementById('tarhal-sound-prompt');
                    if (prompt) prompt.remove();
                    
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    this.showToast('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    updateSoundUI();
                    
                    return true;
                    
                } catch (error) {
                    console.log('âŒ ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', error);
                    this.showToast('âš ï¸ ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª. Ø¬Ø±Ø¨ Ù…ØªØµÙØ­Ø§Ù‹ Ø¢Ø®Ø±', 'error');
                    return false;
                }
            }
            
            toggle() {
                this.enabled = !this.enabled;
                this.savePreferences();
                
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„
                if (this.enabled) {
                    this.play('beep', { volume: 0.3 });
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateSoundUI();
                
                // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
                this.showToast(this.enabled ? 'ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª' : 'ğŸ”‡ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª');
                
                return this.enabled;
            }
            
            setVolume(level) {
                this.volume = Math.max(0, Math.min(1, level / 100));
                this.savePreferences();
                
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ØªØ£ÙƒØ¯
                if (this.enabled && this.volume > 0) {
                    this.play('beep', { volume: this.volume * 0.5 });
                }
            }
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    left: 20px;
                    background: ${type === 'error' ? '#ef4444' : '#4f46e5'};
                    color: white;
                    padding: 14px;
                    border-radius: 12px;
                    text-align: center;
                    font-weight: 600;
                    z-index: 100000;
                    animation: slideUp 0.3s ease;
                    max-width: 400px;
                    margin: 0 auto;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                `;
                
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(20px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }
        
        // ==============================================
        // âœ… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==============================================
        let rideId = null;
        let countdown = 45;
        let countdownInterval = null;
        let soundManager = null;
        let startTime = Date.now();
        
        // ==============================================
        // âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ==============================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ ØµÙØ­Ø© Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©');
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø¯Ø§Ø¦Ù…
            soundManager = new TarhalSoundManager();
            window.soundManager = soundManager;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ rideId Ù…Ù† URL
            const urlParams = new URLSearchParams(window.location.search);
            rideId = urlParams.get('rideId') || 'TEST_' + Date.now();
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            loadTestData();
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (soundManager.enabled) {
                soundManager.play('new_ride', { volume: 0.8 });
                
                // ØªÙƒØ±Ø§Ø± ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(() => {
                    if (countdown > 10 && soundManager.enabled) {
                        soundManager.play('notification', { volume: 0.4 });
                    }
                }, 10000);
            }
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø¥Ø°Ø§ Ù…ØªØ§Ø­
            triggerVibration();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
            startCountdown();
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
            setInterval(updateResponseTime, 1000);
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØµÙˆØª
            updateSoundUI();
        });
        
        // ==============================================
        // âœ… Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ==============================================
        function loadTestData() {
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const testData = {
                customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                customerPhone: '+249 90 123 4567',
                vehicleType: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©',
                pickupLocation: 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ… - Ø§Ù„Ø¹Ù…Ø§Ø±Ø§Øª',
                destination: 'Ø£Ù… Ø¯Ø±Ù…Ø§Ù† - Ø§Ù„Ø³ÙˆÙ‚',
                distance: '5.2 ÙƒÙ…',
                price: '12,500 SDG'
            };
            
            document.getElementById('customer-name').textContent = testData.customerName;
            document.getElementById('customer-phone').textContent = testData.customerPhone;
            document.getElementById('vehicle-type').textContent = testData.vehicleType;
            document.getElementById('pickup-location').textContent = testData.pickupLocation;
            document.getElementById('destination').textContent = testData.destination;
            document.getElementById('distance').textContent = testData.distance;
            document.getElementById('price').textContent = testData.price;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            document.getElementById('status-text').textContent = `Ø·Ù„Ø¨ #${rideId.substring(0, 8)}`;
        }
        
        function startCountdown() {
            const timerElement = document.getElementById('countdown-timer');
            
            countdownInterval = setInterval(() => {
                countdown--;
                timerElement.textContent = countdown;
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©
                document.getElementById('status-text').textContent = `Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯Ùƒ - ${countdown} Ø«Ø§Ù†ÙŠØ©`;
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
                if (countdown <= 10) {
                    timerElement.style.color = '#ef4444';
                    
                    // ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ù‚Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                    if (soundManager?.enabled && countdown <= 5) {
                        soundManager.play('time_warning', { volume: 0.6 });
                    }
                } else if (countdown <= 20) {
                    timerElement.style.color = '#f59e0b';
                }
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    autoDecline();
                }
            }, 1000);
        }
        
        function triggerVibration() {
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }
        
        function updateResponseTime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('response-time').textContent = elapsed;
        }
        
        // ==============================================
        // âœ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø±Ø­Ù„Ø©
        // ==============================================
        async function acceptRide() {
            clearInterval(countdownInterval);
            
            const acceptBtn = document.getElementById('accept-btn');
            const declineBtn = document.getElementById('decline-btn');
            const responseMessage = document.getElementById('response-message');
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            acceptBtn.disabled = true;
            declineBtn.disabled = true;
            acceptBtn.innerHTML = '<span style="display:inline-block;width:16px;height:16px;border:2px solid white;border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø¨ÙˆÙ„';
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù‚Ø¨ÙˆÙ„
            if (soundManager?.enabled) {
                soundManager.play('ride_accepted', { volume: 0.7 });
            }
            
            try {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                responseMessage.innerHTML = `
                    <div style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); padding: 14px; border-radius: var(--radius); border: 2px solid var(--secondary); text-align: center;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <ion-icon name="checkmark-circle" style="font-size: 24px; color: var(--secondary-dark);"></ion-icon>
                            <div style="text-align: right; flex: 1;">
                                <strong style="display: block; color: var(--secondary-dark);">ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!</strong>
                                <span style="font-size: 13px; color: var(--gray);">ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="callCustomer()" style="padding: 10px; margin-top: 10px;">
                            <ion-icon name="call-outline"></ion-icon> Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </button>
                    </div>
                `;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                document.getElementById('status-indicator').innerHTML = `
                    <ion-icon name="checkmark-circle" style="color: var(--secondary-dark);"></ion-icon>
                    <span style="color: var(--secondary-dark);">ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„</span>
                `;
                document.getElementById('status-indicator').style.background = '#dcfce7';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                acceptBtn.style.display = 'none';
                declineBtn.style.display = 'none';
                document.querySelector('.countdown-section').style.display = 'none';
                document.querySelector('.secondary-actions').style.display = 'none';
                
                // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                showNotification('âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©! ØªÙˆØ¬Ù‡ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚.');
                
                // Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„ØªØªØ¨Ø¹
                localStorage.setItem(`tarhal_ride_${rideId}`, JSON.stringify({
                    status: 'accepted',
                    time: new Date().toISOString()
                }));
                
            } catch (error) {
                responseMessage.innerHTML = `
                    <div style="background: #fee2e2; padding: 14px; border-radius: var(--radius); border: 2px solid var(--danger); text-align: center; color: var(--danger);">
                        <ion-icon name="warning"></ion-icon> Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø¨ÙˆÙ„
                    </div>
                `;
                
                acceptBtn.disabled = false;
                declineBtn.disabled = false;
                acceptBtn.innerHTML = '<ion-icon name="checkmark-circle-outline"></ion-icon> Ù‚Ø¨ÙˆÙ„';
            }
        }
        
        async function declineRide() {
            clearInterval(countdownInterval);
            
            const acceptBtn = document.getElementById('accept-btn');
            const declineBtn = document.getElementById('decline-btn');
            const responseMessage = document.getElementById('response-message');
            
            acceptBtn.disabled = true;
            declineBtn.disabled = true;
            declineBtn.innerHTML = '<span style="display:inline-block;width:16px;height:16px;border:2px solid white;border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¶';
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±ÙØ¶
            if (soundManager?.enabled) {
                soundManager.play('ride_declined', { volume: 0.7 });
            }
            
            try {
                await new Promise(resolve => setTimeout(resolve, 800));
                
                responseMessage.innerHTML = `
                    <div style="background: #fef3c7; padding: 14px; border-radius: var(--radius); border: 2px solid var(--warning); text-align: center;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <ion-icon name="information-circle" style="font-size: 24px; color: #92400e;"></ion-icon>
                            <div style="text-align: right; flex: 1;">
                                <strong style="display: block; color: #92400e;">ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø±Ø­Ù„Ø©</strong>
                                <span style="font-size: 13px; color: var(--gray);">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ø³Ø§Ø¦Ù‚ Ø¢Ø®Ø±</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                document.getElementById('status-indicator').innerHTML = `
                    <ion-icon name="close-circle" style="color: #92400e;"></ion-icon>
                    <span style="color: #92400e;">ØªÙ… Ø§Ù„Ø±ÙØ¶</span>
                `;
                document.getElementById('status-indicator').style.background = '#fef3c7';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                acceptBtn.style.display = 'none';
                declineBtn.style.display = 'none';
                document.querySelector('.countdown-section').style.display = 'none';
                document.querySelector('.secondary-actions').style.display = 'none';
                
                showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø±Ø­Ù„Ø©');
                
                // Ø­ÙØ¸ ÙÙŠ localStorage
                localStorage.setItem(`tarhal_ride_${rideId}`, JSON.stringify({
                    status: 'declined',
                    time: new Date().toISOString()
                }));
                
                // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                setTimeout(() => {
                    goBack();
                }, 3000);
                
            } catch (error) {
                responseMessage.innerHTML = `
                    <div style="background: #fee2e2; padding: 14px; border-radius: var(--radius); border: 2px solid var(--danger); text-align: center; color: var(--danger);">
                        <ion-icon name="warning"></ion-icon> Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¶
                    </div>
                `;
                
                declineBtn.disabled = false;
                declineBtn.innerHTML = '<ion-icon name="close-circle-outline"></ion-icon> Ø±ÙØ¶';
            }
        }
        
        function autoDecline() {
            showNotification('â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø±Ø¯! ØªÙ… Ø§Ù„Ø±ÙØ¶ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.');
            declineRide();
        }
        
        // ==============================================
        // âœ… Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ==============================================
        function callCustomer() {
            const phone = document.getElementById('customer-phone').textContent;
            showNotification('ğŸ“ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„...');
            // ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠ: window.open(`tel:${phone}`, '_self');
        }
        
        function viewMap() {
            showNotification('ğŸ—ºï¸ Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©...');
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø®Ø±ÙŠØ·Ø© Ù‡Ù†Ø§
        }
        
        function goBack() {
            showNotification('â†©ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙˆØ¯Ø©...');
            setTimeout(() => {
                window.close(); // Ø£Ùˆ window.history.back();
            }, 500);
        }
        
        function toggleSound() {
            if (!soundManager) return;
            
            const enabled = soundManager.toggle();
            const volumeSlider = document.getElementById('volume-slider');
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ù†Ø²Ù„Ù‚ Ø§Ù„ØµÙˆØª
            if (enabled) {
                volumeSlider.style.display = 'block';
                setTimeout(() => {
                    volumeSlider.style.display = 'none';
                }, 5000);
            } else {
                volumeSlider.style.display = 'none';
            }
        }
        
        function changeVolume(value) {
            if (!soundManager) return;
            soundManager.setVolume(value);
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØµÙˆØª
            updateSoundUI();
        }
        
        function updateSoundUI() {
            if (!soundManager) return;
            
            const icon = document.getElementById('sound-icon');
            const button = document.getElementById('sound-toggle');
            
            if (soundManager.enabled) {
                icon.name = 'volume-high-outline';
                button.style.background = '#4f46e5';
            } else {
                icon.name = 'volume-mute-outline';
                button.style.background = '#6b7280';
            }
        }
        
        // ==============================================
        // âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        // ==============================================
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <ion-icon name="information-circle-outline" style="color: #4f46e5; font-size: 20px;"></ion-icon>
                    <div style="flex: 1;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // ==============================================
        // âœ… Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ø­Ø±ÙƒØ§Øª
        // ==============================================
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        console.log('ğŸ¯ ØµÙØ­Ø© Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„!');
    </script>
// ==============================================
// âœ… Ù†Ø¸Ø§Ù… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
// ==============================================
function enableAudioSystem() {
    console.log('ğŸµ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª...');
    
    // 1. Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
    document.getElementById('audio-enabler').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('audio-enabler').style.display = 'none';
    }, 300);
    
    // 2. Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ ØµÙˆØª ØµØ§Ù…Øª
    const silentAudio = new Audio();
    silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==';
    silentAudio.volume = 0.001;
    
    silentAudio.play().then(() => {
        console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ');
        
        // 3. ØªØ®Ø²ÙŠÙ† ÙÙŠ localStorage
        localStorage.setItem('tarhal_audio_activated', 'true');
        localStorage.setItem('tarhal_audio_time', Date.now());
        
        // 4. ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        playTestSound();
        
        // 5. ØªÙØ¹ÙŠÙ„ soundManager Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯
        if (window.soundManager) {
            window.soundManager.enabled = true;
            window.soundManager.initialized = true;
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            setTimeout(() => {
                if (window.soundManager.play) {
                    window.soundManager.play('new_ride', { volume: 0.7 });
                }
            }, 500);
        }
        
        // 6. Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
        showAudioNotification('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        
    }).catch(error => {
        console.log('âŒ ÙØ´Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
        
        // ØªØ¬Ø±Ø¨Ø© Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©
        tryManualAudioEnable();
    });
}

function tryManualAudioEnable() {
    // Ø·Ø±ÙŠÙ‚Ø© ÙŠØ¯ÙˆÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯
    const testAudio = new Audio('https://assets.mixkit.co/sfx/download/mixkit-alarm-digital-clock-beep-989.mp3');
    testAudio.volume = 0.3;
    
    testAudio.play().then(() => {
        console.log('âœ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù†Ø¬Ø­');
        localStorage.setItem('tarhal_audio_activated', 'true');
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØªØ£ÙƒØ¯
        setTimeout(() => {
            window.location.reload();
        }, 1000);
        
    }).catch(error => {
        console.log('âŒ ÙØ´Ù„ ÙƒØ§Ù…Ù„:', error);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©
        showAudioNotification(`
            âš ï¸ ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹<br>
            <small>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</small>
        `, 'warning');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            document.getElementById('audio-enabler').style.display = 'flex';
            document.getElementById('audio-enabler').style.opacity = '1';
        }, 3000);
    });
}

function skipAudio() {
    document.getElementById('audio-enabler').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('audio-enabler').style.display = 'none';
    }, 300);
    
    localStorage.setItem('tarhal_audio_skipped', 'true');
    showAudioNotification('ğŸ”‡ ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
}

function playTestSound() {
    try {
        const audio = new Audio('https://assets.mixkit.co/sfx/download/mixkit-alarm-digital-clock-beep-989.mp3');
        audio.volume = 0.5;
        audio.play();
    } catch (error) {
        console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
    }
}

function showAudioNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        left: 20px;
        background: ${type === 'warning' ? '#f59e0b' : '#10b981'};
        color: white;
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        font-weight: bold;
        z-index: 100000;
        animation: slideDown 0.3s ease;
        max-width: 400px;
        margin: 0 auto;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    `;
    
    notification.innerHTML = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    const audioActivated = localStorage.getItem('tarhal_audio_activated');
    const audioSkipped = localStorage.getItem('tarhal_audio_skipped');
    
    if (audioActivated === 'true' || audioSkipped === 'true') {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„Ø§Ù‹ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
        document.getElementById('audio-enabler').style.display = 'none';
    } else {
        // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
        setTimeout(() => {
            document.getElementById('audio-enabler').style.opacity = '1';
        }, 500);
    }
});

// ==============================================
// âœ… ØªØ¹Ø¯ÙŠÙ„ soundManager Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
// ==============================================
// ÙÙŠ class TarhalSoundManagerØŒ Ø£Ø¶Ù ÙÙŠ constructor:
// Ø¨Ø¹Ø¯ this.soundLibrary = { ... };
if (!localStorage.getItem('tarhal_audio_activated')) {
    this.enabled = false;
    this.initialized = false;
}
</body>
</html>